var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n=function(e){null==e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,e.constructor==Array?this.init_by_array(e,e.length):this.init_seed(e)};n.prototype.init_seed=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}},n.prototype.init_by_array=function(e,t){var n,r,i;for(this.init_seed(19650218),n=1,r=0,i=this.N>t?this.N:t;i;i--){var a=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(1664525*((4294901760&a)>>>16)<<16)+1664525*(65535&a))+e[r]+r,this.mt[n]>>>=0,r++,++n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1),r>=t&&(r=0)}for(i=this.N-1;i;i--){a=this.mt[n-1]^this.mt[n-1]>>>30;this.mt[n]=(this.mt[n]^(1566083941*((4294901760&a)>>>16)<<16)+1566083941*(65535&a))-n,this.mt[n]>>>=0,++n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1)}this.mt[0]=2147483648},n.prototype.random_int=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;for(this.mti==this.N+1&&this.init_seed(5489),n=0;n<this.N-this.M;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^e>>>1^t[1&e];for(;n<this.N-1;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^e>>>1^t[1&e];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0},n.prototype.random_int31=function(){return this.random_int()>>>1},n.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},n.prototype.random=function(){return this.random_int()*(1/4294967296)},n.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},n.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)};var r=new n(Math.random()*Number.MAX_SAFE_INTEGER);function i(){return r.random()}var a=t(function(e){var t=e.length;for(;t--;)e[t]=Math.floor(256*i());return e});String.prototype.startsWith||(String.prototype.startsWith=function(e){return"string"==typeof e&&0===this.indexOf(e)}),String.prototype.includes||(String.prototype.includes=function(e){return"string"==typeof e&&this.indexOf(e)>=0});const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=function(e){let t,n,r,i,a="",s=0,u=(e=String(e)).length%3;for(;s<e.length;){if((n=e.charCodeAt(s++))>255||(r=e.charCodeAt(s++))>255||(i=e.charCodeAt(s++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");t=n<<16|r<<8|i,a+=o.charAt(t>>18&63)+o.charAt(t>>12&63)+o.charAt(t>>6&63)+o.charAt(63&t)}return u?a.slice(0,u-3)+"===".substring(u):a},u=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;if("undefined"!=typeof self)return self;throw new Error("unable to locate global object")})();void 0===u.globalThis&&Object.defineProperty(u,"globalThis",{get:()=>u}),"undefined"==typeof window&&(window=globalThis),globalThis.__ALIVC_IM_PLATFORM__="wx",globalThis.btoa=s,globalThis.isWxWebAssembly=!0,globalThis.WebAssembly=WXWebAssembly,"object"!=typeof crypto&&(globalThis.crypto={getRandomValues:a});var c={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,a||e,o),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function o(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,a),!0;case 6:return l.fn.call(l.context,t,r,i,a,o),!0}for(c=1,u=new Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,i);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||o(this,a);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[a]=1===c.length?c[0]:c:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(c);var l,f,h,d=t(c.exports),p=(l="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e={}){function t(e,t,n){return t=o(t),function(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,i()?Reflect.construct(t,n||[],o(e).constructor):t.apply(e,n))}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}function r(e){var t="function"==typeof Map?new Map:void 0;return r=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(i())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var o=new(e.bind.apply(e,r));return n&&a(o,n.prototype),o}(e,arguments,o(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,e)},r(e)}function i(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(i=function(){return!!e})()}function a(e,t){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e){var t=function(e,t){if("object"!=d(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==d(t)?t:String(t)}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var p,m,g=e,v=function(){function e(){}function t(e){if(!(this instanceof t))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(e,this)}function n(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,t._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var a;try{a=t(e._value)}catch(e){return void i(n.promise,e)}r(n.promise,a)}else(1===e._state?r:i)(n.promise,e._value)})):e._deferreds.push(n)}function r(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==d(n)||"function"==typeof n)){var r=n.then;if(n instanceof t)return e._state=3,e._value=n,void a(e);if("function"==typeof r)return void s((o=r,u=n,function(){o.apply(u,arguments)}),e)}e._state=1,e._value=n,a(e)}catch(t){i(e,t)}var o,u}function i(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&t._immediateFn(function(){e._handled||t._unhandledRejectionFn(e._value)});for(var r=0,i=e._deferreds.length;r<i;r++)n(e,e._deferreds[r]);e._deferreds=null}function o(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function s(e,t){var n=!1;try{e(function(e){n||(n=!0,r(t,e))},function(e){n||(n=!0,i(t,e))})}catch(e){if(n)return;n=!0,i(t,e)}}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.then=function(t,r){var i=new this.constructor(e);return n(this,new o(t,r,i)),i},t.all=function(e){return new t(function(t,n){if(!Array.isArray(e))return n(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(e);if(0===r.length)return t([]);var i=r.length;function a(e,o){try{if(o&&("object"==d(o)||"function"==typeof o)){var s=o.then;if("function"==typeof s)return void s.call(o,function(t){a(e,t)},n)}r[e]=o,0===--i&&t(r)}catch(e){n(e)}}for(var o=0;o<r.length;o++)a(o,r[o])})},t.resolve=function(e){return e&&"object"==d(e)&&e.constructor==t?e:new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.race=function(e){return new t(function(n,r){if(!Array.isArray(e))return r(new TypeError("Promise.race accepts an array"));for(var i=0,a=e.length;i<a;i++)t.resolve(e[i]).then(n,r)})},t._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){setTimeout(e,0)},t._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},t}();void 0===Object.assign&&(Object.assign=function(e,t){for(var n=1;n<arguments.length;n++)if(t=arguments[n])for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}),g.ready=new v(function(e,t){p=e,m=t});var y=Object.assign({},g),w="./this.program",_=function(e,t){throw t},b="";"undefined"!=typeof document&&document.currentScript&&(b=document.currentScript.src),l&&(b=l),b=0!==b.indexOf("blob:")?b.substr(0,b.replace(/[?#].*/,"").lastIndexOf("/")+1):"";var R,O,I=g.print||console.log.bind(console),E=g.printErr||console.error.bind(console);Object.assign(g,y),y=null,g.arguments&&g.arguments,g.thisProgram&&(w=g.thisProgram),g.quit&&(_=g.quit),g.wasmBinary&&(R=g.wasmBinary),"object"!=("undefined"==typeof WebAssembly?"undefined":d(WebAssembly))&&H("no native wasm support detected");var T,C,S,A,M,P,N,L,x,k=!1,j=[],D=[],F=[],$=[];function U(e){j.unshift(e)}function W(e){$.unshift(e)}if(!Math.fround){var G=new Float32Array(1);Math.fround=function(e){return G[0]=e,G[0]}}Math.clz32||(Math.clz32=function(e){var t=32,n=e>>16;return n&&(t-=16,e=n),(n=e>>8)&&(t-=8,e=n),(n=e>>4)&&(t-=4,e=n),(n=e>>2)&&(t-=2,e=n),(n=e>>1)?t-2:t-e}),Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)});var B=0,z=null;function H(e){var t;null===(t=g.onAbort)||void 0===t||t.call(g,e),E(e="Aborted("+e+")"),k=!0,T=1,e+=". Build with -sASSERTIONS for more info.";var n="run time error";throw m(n),n}var V,q,Y,K=function(e){return e.startsWith("data:application/octet-stream;base64,")};function J(e,t,n){return function(e){return new v((t,n)=>{globalThis.isWxWebAssembly?t(e):wx.getFileSystemManager().readFile({filePath:e,position:0,success:e=>{t(e.data)},fail(e){n(e)}})})}(e).then(function(e){return WebAssembly.instantiate(e,t)}).then(function(e){return e}).then(n,function(e){E("failed to asynchronously prepare wasm: ".concat(e)),H(e)})}K(V="AliVCIM.wasm")||(q=V,V=g.locateFile?g.locateFile(q,b):b+q);var X={468704:function(e){return v.resolve().then(function(){g.EmScriptenHelper.TimeoutRun(e)})},468796:function(e,t){return setTimeout(function(){g.EmScriptenHelper.TimeoutRun(t)},e)},468880:function(e,t){return setInterval(function(){g.EmScriptenHelper.IntervalRun(t)},e)}};function Q(e){this.name="ExitStatus",this.message="Program terminated with exit(".concat(e,")"),this.status=e}var Z=function(e){for(;e.length>0;)e.shift()(g)};g.noExitRuntime;var ee,te,ne,re,ie,ae=[],oe=0,se=0,ue=function(){function e(t){c(this,e),this.excPtr=t,this.ptr=t-24}return f(e,[{key:"set_type",value:function(e){N[this.ptr+4>>2]=e}},{key:"get_type",value:function(){return N[this.ptr+4>>2]}},{key:"set_destructor",value:function(e){N[this.ptr+8>>2]=e}},{key:"get_destructor",value:function(){return N[this.ptr+8>>2]}},{key:"set_caught",value:function(e){e=e?1:0,C[this.ptr+12|0]=e}},{key:"get_caught",value:function(){return 0!=C[this.ptr+12|0]}},{key:"set_rethrown",value:function(e){e=e?1:0,C[this.ptr+13|0]=e}},{key:"get_rethrown",value:function(){return 0!=C[this.ptr+13|0]}},{key:"init",value:function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t)}},{key:"set_adjusted_ptr",value:function(e){N[this.ptr+16>>2]=e}},{key:"get_adjusted_ptr",value:function(){return N[this.ptr+16>>2]}},{key:"get_exception_ptr",value:function(){if(In(this.get_type()))return N[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}]),e}(),ce=function(e){var t=se;if(!t)return vn(0),0;var n=new ue(t);n.set_adjusted_ptr(t);var r=n.get_type();if(!r)return vn(0),t;for(var i in e){var a=e[i];if(0===a||a===r)break;var o=n.ptr+16;if(On(a,r,o))return vn(a),t}return vn(r),t},le="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,fe=function(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.buffer&&le)return le.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)a+=String.fromCharCode(o);else{var c=o-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a},he=function(e,t){return e?fe(S,e,t):""},de=function(e,t,n,r){if(!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=a)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-i},pe=function(e,t,n){return de(e,S,t,n)},me=function(e,t){return Object.defineProperty(t,"name",{value:e})},ge=function(){function e(){c(this,e),this.allocated=[void 0],this.freelist=[]}return f(e,[{key:"get",value:function(e){return this.allocated[e]}},{key:"has",value:function(e){return void 0!==this.allocated[e]}},{key:"allocate",value:function(e){var t=this.freelist.pop()||this.allocated.length;return this.allocated[t]=e,t}},{key:"free",value:function(e){this.allocated[e]=void 0,this.freelist.push(e)}}]),e}(),ve=new ge,ye=function(e){throw new ee(e)},we=function(){for(var e=0,t=ve.reserved;t<ve.allocated.length;++t)void 0!==ve.allocated[t]&&++e;return e},_e=function(e){return e||ye("Cannot use deleted val. handle = "+e),ve.get(e).value},be=function(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return ve.allocate({refcount:1,value:e})}},Re=function(e,t){var n=me(t,function(e){this.name=t,this.message=e;var n=new Error(e).stack;void 0!==n&&(this.stack=this.toString()+"\n"+n.replace(/^Error(:[^\n]*)?\n/,""))});return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:"".concat(this.name,": ").concat(this.message)},n},Oe=function(e){for(var t="",n=e;S[n];)t+=ne[S[n++]];return t},Ie=function(){return Object.keys(Ae).length},Ee=function(){var e=[];for(var t in Ae)Ae.hasOwnProperty(t)&&e.push(Ae[t]);return e},Te=[],Ce=function(){for(;Te.length;){var e=Te.pop();e.$$.deleteScheduled=!1,e.delete()}},Se=function(e){re=e,Te.length&&re&&re(Ce)},Ae={},Me=function(e,t){for(void 0===t&&ye("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t},Pe={},Ne=function(e){var t=mn(e),n=Oe(t);return dn(t),n},Le=function(e,t){var n=Pe[e];return void 0===n&&ye(t+" has unknown type "+Ne(e)),n},xe=function(e){},ke=!1,je=function(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)},De=function e(t,n,r){if(n===r)return t;if(void 0===r.baseClass)return null;var i=e(t,n,r.baseClass);return null===i?null:r.downcast(i)},Fe={},$e=function(e){throw new ie(e)},Ue=function(e,t){return t.ptrType&&t.ptr||$e("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&$e("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Ge(Object.create(e,{$$:{value:t,writable:!0}}))};function We(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var n=function(e,t){return t=Me(e,t),Ae[t]}(this.registeredClass,t);if(void 0!==n){if(0===n.$$.count.value)return n.$$.ptr=t,n.$$.smartPtr=e,n.clone();var r=n.clone();return this.destructor(e),r}function i(){return this.isSmartPointer?Ue(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Ue(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var a,o=this.registeredClass.getActualType(t),s=Fe[o];if(!s)return i.call(this);a=this.isConst?s.constPointerType:s.pointerType;var u=De(t,this.registeredClass,a.registeredClass);return null===u?i.call(this):this.isSmartPointer?Ue(a.registeredClass.instancePrototype,{ptrType:a,ptr:u,smartPtrType:this,smartPtr:e}):Ue(a.registeredClass.instancePrototype,{ptrType:a,ptr:u})}var Ge=function(e){return"undefined"==typeof FinalizationRegistry?(Ge=function(e){return e},e):(ke=new FinalizationRegistry(function(e){je(e.$$)}),Ge=function(e){var t=e.$$;if(t.smartPtr){var n={$$:t};ke.register(e,n,e)}return e},xe=function(e){return ke.unregister(e)},Ge(e))},Be={},ze=function(e){for(;e.length;){var t=e.pop();e.pop()(t)}};function He(e){return this.fromWireType(P[e>>2])}var Ve={},qe={},Ye=function(e,t,n){function r(t){var r=n(t);r.length!==e.length&&$e("Mismatched type converter count");for(var i=0;i<e.length;++i)Ke(e[i],r[i])}e.forEach(function(e){qe[e]=t});var i=new Array(t.length),a=[],o=0;t.forEach(function(e,t){Pe.hasOwnProperty(e)?i[t]=Pe[e]:(a.push(e),Ve.hasOwnProperty(e)||(Ve[e]=[]),Ve[e].push(function(){i[t]=Pe[e],++o===a.length&&r(i)}))}),0===a.length&&r(i)};function Ke(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.name;if(e||ye('type "'.concat(r,'" must have a positive integer typeid pointer')),Pe.hasOwnProperty(e)){if(n.ignoreDuplicateRegistrations)return;ye("Cannot register type '".concat(r,"' twice"))}if(Pe[e]=t,delete qe[e],Ve.hasOwnProperty(e)){var i=Ve[e];delete Ve[e],i.forEach(function(e){return e()})}}(e,t,n)}var Je=8,Xe=function(e){ye(e.$$.ptrType.registeredClass.name+" instance already deleted")};function Qe(){}var Ze=function(e,t,n){if(void 0===e[t].overloadTable){var r=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||ye("Function '".concat(n,"' called with an invalid number of arguments (").concat(arguments.length,") - expects one of (").concat(e[t].overloadTable,")!")),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[r.argCount]=r}},et=function(e,t,n){g.hasOwnProperty(e)?(ye("Cannot register public name '".concat(e,"' twice")),Ze(g,e,e),g.hasOwnProperty(n)&&ye("Cannot register multiple overloads of a function with the same number of arguments (".concat(n,")!")),g[e].overloadTable[n]=t):g[e]=t};function tt(e,t,n,r,i,a,o,s){this.name=e,this.constructor=t,this.instancePrototype=n,this.rawDestructor=r,this.baseClass=i,this.getActualType=a,this.upcast=o,this.downcast=s,this.pureVirtualFunctions=[]}var nt=function(e,t,n){for(;t!==n;)t.upcast||ye("Expected null or instance of ".concat(n.name,", got an instance of ").concat(t.name)),e=t.upcast(e),t=t.baseClass;return e};function rt(e,t){if(null===t)return this.isReference&&ye("null is not a valid ".concat(this.name)),0;t.$$||ye('Cannot pass "'.concat(Rt(t),'" as a ').concat(this.name)),t.$$.ptr||ye("Cannot pass deleted object as a pointer of type ".concat(this.name));var n=t.$$.ptrType.registeredClass;return nt(t.$$.ptr,n,this.registeredClass)}function it(e,t){var n;if(null===t)return this.isReference&&ye("null is not a valid ".concat(this.name)),this.isSmartPointer?(n=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,n),n):0;t&&t.$$||ye('Cannot pass "'.concat(Rt(t),'" as a ').concat(this.name)),t.$$.ptr||ye("Cannot pass deleted object as a pointer of type ".concat(this.name)),!this.isConst&&t.$$.ptrType.isConst&&ye("Cannot convert argument of type ".concat(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name," to parameter type ").concat(this.name));var r=t.$$.ptrType.registeredClass;if(n=nt(t.$$.ptr,r,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&ye("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?n=t.$$.smartPtr:ye("Cannot convert argument of type ".concat(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name," to parameter type ").concat(this.name));break;case 1:n=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)n=t.$$.smartPtr;else{var i=t.clone();n=this.rawShare(n,be(function(){return i.delete()})),null!==e&&e.push(this.rawDestructor,n)}break;default:ye("Unsupporting sharing policy")}return n}function at(e,t){if(null===t)return this.isReference&&ye("null is not a valid ".concat(this.name)),0;t.$$||ye('Cannot pass "'.concat(Rt(t),'" as a ').concat(this.name)),t.$$.ptr||ye("Cannot pass deleted object as a pointer of type ".concat(this.name)),t.$$.ptrType.isConst&&ye("Cannot convert argument of type ".concat(t.$$.ptrType.name," to parameter type ").concat(this.name));var n=t.$$.ptrType.registeredClass;return nt(t.$$.ptr,n,this.registeredClass)}function ot(e){return this.fromWireType(N[e>>2])}function st(e,t,n,r,i,a,o,s,u,c,l){this.name=e,this.registeredClass=t,this.isReference=n,this.isConst=r,this.isSmartPointer=i,this.pointeeType=a,this.sharingPolicy=o,this.rawGetPointee=s,this.rawConstructor=u,this.rawShare=c,this.rawDestructor=l,i||void 0!==t.baseClass?this.toWireType=it:r?(this.toWireType=rt,this.destructorFunction=null):(this.toWireType=at,this.destructorFunction=null)}var ut,ct,lt=function(e){return ut.get(e)},ft=function(e,t,n){return e.includes("j")?function(e,t,n){var r=g["dynCall_"+e];return n&&n.length?r.apply(null,[t].concat(n)):r.call(null,t)}(e,t,n):lt(t).apply(null,n)},ht=function(e,t){var n,r,i,a=(e=Oe(e)).includes("j")?(n=e,r=t,i=[],function(){return i.length=0,Object.assign(i,arguments),ft(n,r,i)}):lt(t);return"function"!=typeof a&&ye("unknown function pointer with signature ".concat(e,": ").concat(t)),a},dt=function(e,t){var n=[],r={};throw t.forEach(function e(t){r[t]||Pe[t]||(qe[t]?qe[t].forEach(e):(n.push(t),r[t]=!0))}),new ct("".concat(e,": ")+n.map(Ne).join([", "]))};function pt(e,t,n,r,i,a){var o=t.length;o<2&&ye("argTypes array size mismatch! Must at least get return value and 'this' types!");var s=null!==t[1]&&null!==n,u=function(e){for(var t=1;t<e.length;++t)if(null!==e[t]&&void 0===e[t].destructorFunction)return!0;return!1}(t),c="void"!==t[0].name,l=o-2,f=new Array(l),h=[],d=[];return me(e,function(){var n;arguments.length!==l&&ye("function ".concat(e," called with ").concat(arguments.length," arguments, expected ").concat(l)),d.length=0,h.length=s?2:1,h[0]=i,s&&(n=t[1].toWireType(d,this),h[1]=n);for(var a=0;a<l;++a)f[a]=t[a+2].toWireType(d,arguments[a]),h.push(f[a]);return function(e){if(u)ze(d);else for(var r=s?1:2;r<t.length;r++){var i=1===r?n:f[r-2];null!==t[r].destructorFunction&&t[r].destructorFunction(i)}if(c)return t[0].fromWireType(e)}(r.apply(null,h))})}var mt,gt=function(e,t){for(var n=[],r=0;r<e;r++)n.push(N[t+4*r>>2]);return n},vt=function(e){var t=(e=e.trim()).indexOf("(");return-1!==t?e.substr(0,t):e},yt=function(e,t,n){return e instanceof Object||ye("".concat(n,' with invalid "this": ').concat(e)),e instanceof t.registeredClass.constructor||ye("".concat(n,' incompatible with "this" of type ').concat(e.constructor.name)),e.$$.ptr||ye("cannot call emscripten binding method ".concat(n," on deleted object")),nt(e.$$.ptr,e.$$.ptrType.registeredClass,t.registeredClass)},wt=function(e){e>=ve.reserved&&0===--ve.get(e).refcount&&ve.free(e)},_t={name:"emscripten::val",fromWireType:function(e){var t=_e(e);return wt(e),t},toWireType:function(e,t){return be(t)},argPackAdvance:Je,readValueFromPointer:He,destructorFunction:null},bt=function(e,t,n){switch(t){case 1:return n?function(e){return this.fromWireType(C[0|e])}:function(e){return this.fromWireType(S[0|e])};case 2:return n?function(e){return this.fromWireType(A[e>>1])}:function(e){return this.fromWireType(M[e>>1])};case 4:return n?function(e){return this.fromWireType(P[e>>2])}:function(e){return this.fromWireType(N[e>>2])};default:throw new TypeError("invalid integer width (".concat(t,"): ").concat(e))}},Rt=function(e){if(null===e)return"null";var t=d(e);return"object"===t||"array"===t||"function"===t?e.toString():""+e},Ot=function(e,t){switch(t){case 4:return function(e){return this.fromWireType(L[e>>2])};case 8:return function(e){return this.fromWireType(x[e>>3])};default:throw new TypeError("invalid float width (".concat(t,"): ").concat(e))}},It=function(e,t,n){switch(t){case 1:return n?function(e){return C[0|e]}:function(e){return S[0|e]};case 2:return n?function(e){return A[e>>1]}:function(e){return M[e>>1]};case 4:return n?function(e){return P[e>>2]}:function(e){return N[e>>2]};default:throw new TypeError("invalid integer width (".concat(t,"): ").concat(e))}},Et=function(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r<=127?t++:r<=2047?t+=2:r>=55296&&r<=57343?(t+=4,++n):t+=3}return t},Tt="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0,Ct=function(e,t){for(var n=e,r=n>>1,i=r+t/2;!(r>=i)&&M[r];)++r;if((n=r<<1)-e>32&&Tt)return Tt.decode(S.subarray(e,n));for(var a="",o=0;!(o>=t/2);++o){var s=A[e+2*o>>1];if(0==s)break;a+=String.fromCharCode(s)}return a},St=function(e,t,n){var r;if(null!==(r=n)&&void 0!==r||(n=2147483647),n<2)return 0;for(var i=t,a=(n-=2)<2*e.length?n/2:e.length,o=0;o<a;++o){var s=e.charCodeAt(o);A[t>>1]=s,t+=2}return A[t>>1]=0,t-i},At=function(e){return 2*e.length},Mt=function(e,t){for(var n=0,r="";!(n>=t/4);){var i=P[e+4*n>>2];if(0==i)break;if(++n,i>=65536){var a=i-65536;r+=String.fromCharCode(55296|a>>10,56320|1023&a)}else r+=String.fromCharCode(i)}return r},Pt=function(e,t,n){var r;if(null!==(r=n)&&void 0!==r||(n=2147483647),n<4)return 0;for(var i=t,a=i+n-4,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),P[t>>2]=s,(t+=4)+4>a)break}return P[t>>2]=0,t-i},Nt=function(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&++n,t+=4}return t},Lt=[],xt={},kt=null,jt=function(e,t){return t+2097152>>>0<4194305-!!e?(e>>>0)+4294967296*t:NaN},Dt=function(e){return e%4==0&&(e%100!=0||e%400==0)},Ft=[0,31,60,91,121,152,182,213,244,274,305,335],$t=[0,31,59,90,120,151,181,212,243,273,304,334],Ut=function(e){return(Dt(e.getFullYear())?Ft:$t)[e.getMonth()]+e.getDate()-1},Wt=function(e){var t=Et(e)+1,n=hn(t);return n&&pe(e,n,t),n},Gt=[],Bt=function(e,t,n){var r=function(e,t){var n;for(Gt.length=0;n=S[e++];){var r=105!=n;t+=(r&=112!=n)&&t%8?4:0,Gt.push(112==n?N[t>>2]:105==n?P[t>>2]:x[t>>3]),t+=r?8:4}return Gt}(t,n);return X[e].apply(null,r)},zt=clearTimeout;mt=function(){return Date.now()};var Ht=function(e){if(e instanceof Q||"unwind"==e)return T;_(1,e)},Vt=function(e,t){var n;T=e,T=n=e,_(n,new Q(n))},qt=function(e){if(!k)try{e()}catch(e){Ht(e)}},Yt={getDB:(e,t,n)=>{var r=wx.env.USER_DATA_PATH+t.replace("//stat/aio_stat","/"+e);r.endsWith("/")||(r+="/");var i=wx.getFileSystemManager();i.stat({path:r,success:e=>n(null,r),fail:e=>(i.mkdir({dirPath:r,recursive:!0,success(e){},fail(e){}}),n(null,r))})},getStore(e,t,n){Yt.getDB(e,t,(e,t)=>{e&&n(e),wx.getFileSystemManager().stat({path:t,success:e=>{n(null,t)},fail:e=>{n(null,t)}})})},getFile(e,t,n){Yt.getStore(e,t,(e,t)=>{wx.getFileSystemManager().readFile({filePath:t,success:e=>{n(null,e.data)},fail:e=>{n(e)}})})},setFile(e,t,n,r){Yt.getStore(e,t,(e,t)=>{wx.getFileSystemManager().writeFile({filePath:t,data:n.buffer,success:e=>{r()},fail:e=>{r(e)}})})},deleteFile(e,t,n){Yt.getStore(e,t,(e,t)=>{wx.getFileSystemManager().unlink({filePath:t,success:e=>{n()},fail:e=>{n(e)}})})},storeExistsFile(e,t){},existsFile(e,t,n){Yt.getStore(e,t,(e,t)=>{var r=!1;try{wx.getFileSystemManager().stat({path:t,success:e=>{r=e.stats.isFile(),n(null,r)},fail:e=>{n(null,!1)}})}catch(e){}})},clearStore(e,t){Yt.getStore(e,id,(e,n)=>{wx.getFileSystemManager().rmdir({filePath:n,success:e=>{t(null,e.data)},fail:e=>{t(e)}})})}},Kt=Uint8Array.prototype.copyWithin?function(e,t,n){return S.copyWithin(e,t,t+n)}:function(e,t,n){return S.set(S.subarray(t,t+n),e)},Jt={init:function(){Jt.xhrs=new ge}};function Xt(e,t,n,r,i){var a=N[e+8>>2];if(a){var o=he(a),s=e+112,u=he(s+0);u||(u="GET"),N[s+56>>2];var c=N[s+68>>2],l=N[s+72>>2],f=N[s+76>>2];N[s+80>>2];var h=N[s+84>>2],d=N[s+88>>2];N[s+52>>2],c&&he(c),l&&he(l);var p={},m="application/x-protobuf";if(f)for(;;){var g=N[f>>2];if(!g)break;var v=N[f+4>>2];if(!v)break;f+=8;var y=he(g),w=he(v);"content-type"==y.toLowerCase()?m=w:p[y]=w}var _=Jt.xhrs.allocate({});N[e>>2]=_;var b=h&&d?S.slice(h,h+d):null;wx.request({url:o,method:u,data:d>0?b.buffer:"",header:{"content-type":m,...p},success(r){var i="";r.data&&""!=r.data&&(i=JSON.stringify(r.data)),R(function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return t}(i)),200===r.statusCode?t(e,0,null):n(e,0,r)},fail(t){R(new ArrayBuffer),n(e,0,t)}})}else n(e,0,"no url specified!");function R(t){var n=0,r=0;0===N[e+12>>2]&&(r=t.byteLength),r>0&&(n=hn(r),S.set(new Uint8Array(t),n)),N[e+12>>2]=n,Qt(e+16,r),Qt(e+24,0);var i=t?t.byteLength:0;i&&Qt(e+32,i),M[e+40>>1]=4,M[e+42>>1]=200,0===i&&pe("OK",e+44,64)}}var Qt=function(e,t){N[e>>2]=t;var n=N[e>>2];N[e+4>>2]=(t-n)/4294967296},Zt={},en=function e(){if(!e.strings){var t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==("undefined"==typeof navigator?"undefined":d(navigator))&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:w||"./this.program"};for(var n in Zt)void 0===Zt[n]?delete t[n]:t[n]=Zt[n];var r=[];for(var n in t)r.push("".concat(n,"=").concat(t[n]));e.strings=r}return e.strings},tn=[null,[],[]],nn=function(e,t){var n=tn[e];0===t||10===t?((1===e?I:E)(fe(n,0)),n.length=0):n.push(t)},rn=function(e){return(rn=function(){if("object"==("undefined"==typeof crypto?"undefined":d(crypto))&&"function"==typeof crypto.getRandomValues)return function(e){return crypto.getRandomValues(e)};H("initRandomDevice")}())(e)},an=[31,29,31,30,31,30,31,31,30,31,30,31],on=[31,28,31,30,31,30,31,31,30,31,30,31],sn=function(e,t){C.set(e,t)},un=function(e,t,n,r){var i=N[r+40>>2],a={tm_sec:P[r>>2],tm_min:P[r+4>>2],tm_hour:P[r+8>>2],tm_mday:P[r+12>>2],tm_mon:P[r+16>>2],tm_year:P[r+20>>2],tm_wday:P[r+24>>2],tm_yday:P[r+28>>2],tm_isdst:P[r+32>>2],tm_gmtoff:P[r+36>>2],tm_zone:i?he(i):""},o=he(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var u in s)o=o.replace(new RegExp(u,"g"),s[u]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["January","February","March","April","May","June","July","August","September","October","November","December"];function f(e,t,n){for(var r="number"==typeof e?e.toString():e||"";r.length<t;)r=n[0]+r;return r}function h(e,t){return f(e,t,"0")}function d(e,t){function n(e){return e<0?-1:e>0?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function p(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function m(e){var t=function(e,t){for(var n=new Date(e.getTime());t>0;){var r=Dt(n.getFullYear()),i=n.getMonth(),a=(r?an:on)[i];if(!(t>a-n.getDate()))return n.setDate(n.getDate()+t),n;t-=a-n.getDate()+1,n.setDate(1),i<11?n.setMonth(i+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1))}return n}(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),r=new Date(t.getFullYear()+1,0,4),i=p(n),a=p(r);return d(i,t)<=0?d(a,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return c[e.tm_wday].substring(0,3)},"%A":function(e){return c[e.tm_wday]},"%b":function(e){return l[e.tm_mon].substring(0,3)},"%B":function(e){return l[e.tm_mon]},"%C":function(e){return h((e.tm_year+1900)/100|0,2)},"%d":function(e){return h(e.tm_mday,2)},"%e":function(e){return f(e.tm_mday,2," ")},"%g":function(e){return m(e).toString().substring(2)},"%G":m,"%H":function(e){return h(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),h(t,2)},"%j":function(e){return h(e.tm_mday+function(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}(Dt(e.tm_year+1900)?an:on,e.tm_mon-1),3)},"%m":function(e){return h(e.tm_mon+1,2)},"%M":function(e){return h(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return h(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=e.tm_yday+7-e.tm_wday;return h(Math.floor(t/7),2)},"%V":function(e){var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var n=(e.tm_wday+371-e.tm_yday)%7;4==n||3==n&&Dt(e.tm_year)||(t=1)}}else{t=52;var r=(e.tm_wday+7-e.tm_yday-1)%7;(4==r||5==r&&Dt(e.tm_year%400-1))&&t++}return h(t,2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=e.tm_yday+7-(e.tm_wday+6)%7;return h(Math.floor(t/7),2)},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,n=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(n?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var u in o=o.replace(/%%/g,"\0\0"),g)o.includes(u)&&(o=o.replace(new RegExp(u,"g"),g[u](a)));o=o.replace(/\0\0/g,"%");var v,y,w,_=(y=Et(v=o)+1,w=new Array(y),de(v,w,0,w.length),w);return _.length>t?0:(sn(_,e),_.length-1)},cn=Wt;Object.getOwnPropertyDescriptor(Function.prototype,"name").configurable||(me=function(e,t){return t}),ee=g.BindingError=function(e){function r(e){var n;return c(this,r),(n=t(this,r,[e])).name="BindingError",n}return n(r,e),f(r)}(r(Error)),ve.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),Object.assign(ve,{reserved:ve.allocated.length}),g.count_emval_handles=we,te=g.PureVirtualError=Re(Error,"PureVirtualError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);ne=e}(),g.getInheritedInstanceCount=Ie,g.getLiveInheritedInstances=Ee,g.flushPendingDeletes=Ce,g.setDelayFunction=Se,ie=g.InternalError=function(e){function r(e){var n;return c(this,r),(n=t(this,r,[e])).name="InternalError",n}return n(r,e),f(r)}(r(Error)),Object.assign(Qe.prototype,{isAliasOf:function(e){if(!(this instanceof Qe))return!1;if(!(e instanceof Qe))return!1;var t=this.$$.ptrType.registeredClass,n=this.$$.ptr;e.$$=e.$$;for(var r=e.$$.ptrType.registeredClass,i=e.$$.ptr;t.baseClass;)n=t.upcast(n),t=t.baseClass;for(;r.baseClass;)i=r.upcast(i),r=r.baseClass;return t===r&&n===i},clone:function(){if(this.$$.ptr||Xe(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=Ge(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t},delete:function(){this.$$.ptr||Xe(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ye("Object already scheduled for deletion"),xe(this),je(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted:function(){return!this.$$.ptr},deleteLater:function(){return this.$$.ptr||Xe(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ye("Object already scheduled for deletion"),Te.push(this),1===Te.length&&re&&re(Ce),this.$$.deleteScheduled=!0,this}}),Object.assign(st.prototype,{getPointee:function(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e},destructor:function(e){var t;null===(t=this.rawDestructor)||void 0===t||t.call(this,e)},argPackAdvance:Je,readValueFromPointer:ot,fromWireType:We}),ct=g.UnboundTypeError=Re(Error,"UnboundTypeError"),kt="undefined"!=typeof Reflect?Reflect.construct:function(e,t){return new(e.bind.apply(e,[null].concat(t)))},Jt.init();var ln={z:function(e){var t=new ue(e);return t.get_caught()||(t.set_caught(!0),oe--),t.set_rethrown(!1),ae.push(t),Rn(t.excPtr),t.get_exception_ptr()},C:function(){gn(0,0);var e=ae.pop();bn(e.excPtr),se=0},c:function(){return ce([])},j:function(e){return ce([e])},_:function(){var e=ae.pop();e||H("no exception to throw");var t=e.excPtr;throw e.get_rethrown()||(ae.push(e),e.set_rethrown(!0),e.set_caught(!1),oe++),se=t},r:function(e,t,n){throw new ue(e).init(t,n),oe++,se=e},la:function(){return oe},g:function(e){throw se||(se=e),se},Ba:function(e,t,n,r){},ba:function(e,t,n){return 0},xa:function(e,t){},qa:function(e,t,n){},ya:function(e,t,n){return 0},ua:function(e,t){},ra:function(e,t,n){},va:function(e,t,n,r){},ca:function(e,t,n,r){},oa:function(e){},wa:function(e,t){},pa:function(e,t,n){},u:function(e,t,n){e=Oe(e),t=Le(t,"wrapper"),n=_e(n);var r=[].slice,i=t.registeredClass,a=i.instancePrototype,o=i.baseClass.instancePrototype,s=i.baseClass.constructor,u=me(e,function(){i.baseClass.pureVirtualFunctions.forEach(function(e){if(this[e]===o[e])throw new te("Pure virtual function ".concat(e," must be implemented in JavaScript"))}.bind(this)),Object.defineProperty(this,"__parent",{value:a}),this.__construct.apply(this,r.call(arguments))});return a.__construct=function(){this===a&&ye("Pass correct 'this' to __construct");var e=s.implement.apply(void 0,[this].concat(r.call(arguments)));xe(e);var t,n,o,u=e.$$;e.notifyOnDestruction(),u.preservePointerOnDelete=!0,Object.defineProperties(this,{$$:{value:u}}),Ge(this),t=i,n=u.ptr,o=this,n=Me(t,n),Ae.hasOwnProperty(n)?ye("Tried to register registered instance: ".concat(n)):Ae[n]=o},a.__destruct=function(){var e,t;this===a&&ye("Pass correct 'this' to __destruct"),xe(this),e=i,t=this.$$.ptr,t=Me(e,t),Ae.hasOwnProperty(t)?delete Ae[t]:ye("Tried to unregister unregistered instance: ".concat(t))},u.prototype=Object.create(a),Object.assign(u.prototype,n),be(u)},I:function(e){var t=Be[e];delete Be[e];var n=t.rawConstructor,r=t.rawDestructor,i=t.fields,a=i.map(function(e){return e.getterReturnType}).concat(i.map(function(e){return e.setterArgumentType}));Ye([e],a,function(e){var a={};return i.forEach(function(t,n){var r=t.fieldName,o=e[n],s=t.getter,u=t.getterContext,c=e[n+i.length],l=t.setter,f=t.setterContext;a[r]={read:function(e){return o.fromWireType(s(u,e))},write:function(e,t){var n=[];l(f,e,c.toWireType(n,t)),ze(n)}}}),[{name:t.name,fromWireType:function(e){var t={};for(var n in a)t[n]=a[n].read(e);return r(e),t},toWireType:function(e,t){for(var i in a)if(!(i in t))throw new TypeError('Missing field: "'.concat(i,'"'));var o=n();for(i in a)a[i].write(o,t[i]);return null!==e&&e.push(r,o),o},argPackAdvance:Je,readValueFromPointer:He,destructorFunction:r}]})},bb:function(e,t,n,r,i){},Da:function(e,t,n,r){Ke(e,{name:t=Oe(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:r},argPackAdvance:Je,readValueFromPointer:function(e){return this.fromWireType(S[e])},destructorFunction:null})},h:function(e,t,n,r,i,a,o,s,u,c,l,f,h){l=Oe(l),a=ht(i,a),s&&(s=ht(o,s)),c&&(c=ht(u,c)),h=ht(f,h);var d=function(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_".concat(e):e}(l);et(d,function(){dt("Cannot construct ".concat(l," due to unbound types"),[r])}),Ye([e,t,n],r?[r]:[],function(t){var n,i;t=t[0],i=r?(n=t.registeredClass).instancePrototype:Qe.prototype;var o=me(l,function(){if(Object.getPrototypeOf(this)!==u)throw new ee("Use 'new' to construct "+l);if(void 0===m.constructor_body)throw new ee(l+" has no accessible constructor");var e=m.constructor_body[arguments.length];if(void 0===e)throw new ee("Tried to invoke ctor of ".concat(l," with invalid number of parameters (").concat(arguments.length,") - expected (").concat(Object.keys(m.constructor_body).toString(),") parameters instead!"));return e.apply(this,arguments)}),u=Object.create(i,{constructor:{value:o}});o.prototype=u;var f,p,m=new tt(l,o,u,h,n,a,s,c);m.baseClass&&(null!==(p=(f=m.baseClass).__derivedClasses)&&void 0!==p||(f.__derivedClasses=[]),m.baseClass.__derivedClasses.push(m));var v=new st(l,m,!0,!1,!1),y=new st(l+"*",m,!1,!1,!1),w=new st(l+" const*",m,!1,!0,!1);return Fe[e]={pointerType:y,constPointerType:w},function(e,t,n){g.hasOwnProperty(e)||$e("Replacing nonexistant public symbol"),void 0!==g[e].overloadTable&&void 0!==n||(g[e]=t,g[e].argCount=n)}(d,o),[v,y,w]})},p:function(e,t,n,r,i,a,o,u){var c=gt(n,r);t=Oe(t),t=vt(t),a=ht(i,a),Ye([],[e],function(e){e=e[0];var r="".concat(e.name,".").concat(t);function i(){dt("Cannot call ".concat(r," due to unbound types"),c)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]);var u=e.registeredClass.constructor;return void 0===u[t]?(i.argCount=n-1,u[t]=i):(Ze(u,t,r),u[t].overloadTable[n-1]=i),Ye([],c,function(i){var c=[i[0],null].concat(i.slice(1)),l=pt(r,c,null,a,o);if(void 0===u[t].overloadTable?(l.argCount=n-1,u[t]=l):u[t].overloadTable[n-1]=l,e.registeredClass.__derivedClasses){var f,h=s(e.registeredClass.__derivedClasses);try{for(h.s();!(f=h.n()).done;){var d=f.value;d.constructor.hasOwnProperty(t)||(d.constructor[t]=l)}}catch(e){h.e(e)}finally{h.f()}}return[]}),[]})},k:function(e,t,n,r,i,a){var o=gt(t,n);i=ht(r,i),Ye([],[e],function(e){e=e[0];var n="constructor ".concat(e.name);if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new ee("Cannot register multiple constructors with identical number of parameters (".concat(t-1,") for class '").concat(e.name,"'! Overload resolution is currently only performed using the parameter count, not actual type info!"));return e.registeredClass.constructor_body[t-1]=function(){dt("Cannot construct ".concat(e.name," due to unbound types"),o)},Ye([],o,function(r){return r.splice(1,0,null),e.registeredClass.constructor_body[t-1]=pt(n,r,null,i,a),[]}),[]})},b:function(e,t,n,r,i,a,o,s,u){var c=gt(n,r);t=Oe(t),t=vt(t),a=ht(i,a),Ye([],[e],function(e){e=e[0];var r="".concat(e.name,".").concat(t);function i(){dt("Cannot call ".concat(r," due to unbound types"),c)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),s&&e.registeredClass.pureVirtualFunctions.push(t);var u=e.registeredClass.instancePrototype,l=u[t];return void 0===l||void 0===l.overloadTable&&l.className!==e.name&&l.argCount===n-2?(i.argCount=n-2,i.className=e.name,u[t]=i):(Ze(u,t,r),u[t].overloadTable[n-2]=i),Ye([],c,function(i){var s=pt(r,i,e,a,o);return void 0===u[t].overloadTable?(s.argCount=n-2,u[t]=s):u[t].overloadTable[n-2]=s,[]}),[]})},f:function(e,t,n,r,i,a,o,s,u,c){t=Oe(t),i=ht(r,i),Ye([],[e],function(e){e=e[0];var r="".concat(e.name,".").concat(t),l={get:function(){dt("Cannot access ".concat(r," due to unbound types"),[n,o])},enumerable:!0,configurable:!0};return l.set=u?function(){return dt("Cannot access ".concat(r," due to unbound types"),[n,o])}:function(e){return ye(r+" is a read-only property")},Object.defineProperty(e.registeredClass.instancePrototype,t,l),Ye([],u?[n,o]:[n],function(n){var o=n[0],l={get:function(){var t=yt(this,e,r+" getter");return o.fromWireType(i(a,t))},enumerable:!0};if(u){u=ht(s,u);var f=n[1];l.set=function(t){var n=yt(this,e,r+" setter"),i=[];u(c,n,f.toWireType(i,t)),ze(i)}}return Object.defineProperty(e.registeredClass.instancePrototype,t,l),[]}),[]})},w:function(e,t,n){e=Oe(e),Ye([],[t],function(t){return t=t[0],g[e]=t.fromWireType(n),[]})},Ca:function(e){return Ke(e,_t)},E:function(e,t,n,r){function i(){}t=Oe(t),i.values={},Ke(e,{name:t,constructor:i,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:Je,readValueFromPointer:bt(t,n,r),destructorFunction:null}),et(t,i)},l:function(e,t,n){var r=Le(e,"enum");t=Oe(t);var i=r.constructor,a=Object.create(r.constructor.prototype,{value:{value:n},constructor:{value:me("".concat(r.name,"_").concat(t),function(){})}});i.values[n]=a,i[t]=a},ea:function(e,t,n){Ke(e,{name:t=Oe(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:Je,readValueFromPointer:Ot(t,n),destructorFunction:null})},G:function(e,t,n,r,i){t=Oe(t);var a=function(e){return e};if(0===r){var o=32-8*n;a=function(e){return e<<o>>>o}}var s=t.includes("unsigned");Ke(e,{name:t,fromWireType:a,toWireType:s?function(e,t){return this.name,t>>>0}:function(e,t){return this.name,t},argPackAdvance:Je,readValueFromPointer:It(t,n,0!==r),destructorFunction:null})},A:function(e,t,n){var r=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=N[e>>2],n=N[e+4>>2];return new r(C.buffer,n,t)}Ke(e,{name:n=Oe(n),fromWireType:i,argPackAdvance:Je,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},q:function(e,t,n,r,i,a,o,s,u,c,l,f){n=Oe(n),a=ht(i,a),s=ht(o,s),c=ht(u,c),f=ht(l,f),Ye([e],[t],function(e){return e=e[0],[new st(n,e.registeredClass,!1,!1,!0,e,r,a,s,c,f)]})},da:function(e,t){var n="std::string"===(t=Oe(t));Ke(e,{name:t,fromWireType:function(e){var t,r=N[e>>2],i=e+4;if(n)for(var a=i,o=0;o<=r;++o){var s=i+o;if(o==r||0==S[s]){var u=he(a,s-a);void 0===t?t=u:(t+=String.fromCharCode(0),t+=u),a=s+1}}else{var c=new Array(r);for(o=0;o<r;++o)c[o]=String.fromCharCode(S[i+o]);t=c.join("")}return dn(e),t},toWireType:function(e,t){var r;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var i="string"==typeof t;i||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ye("Cannot pass non-string to std::string"),r=n&&i?Et(t):t.length;var a=hn(4+r+1),o=a+4;if(N[a>>2]=r,n&&i)pe(t,o,r+1);else if(i)for(var s=0;s<r;++s){var u=t.charCodeAt(s);u>255&&(dn(o),ye("String has UTF-16 code units that do not fit in 8 bits")),S[o+s]=u}else for(s=0;s<r;++s)S[o+s]=t[s];return null!==e&&e.push(dn,a),a},argPackAdvance:Je,readValueFromPointer:ot,destructorFunction:function(e){dn(e)}})},U:function(e,t,n){var r,i,a,o,s;n=Oe(n),2===t?(r=Ct,i=St,o=At,a=function(){return M},s=1):4===t&&(r=Mt,i=Pt,o=Nt,a=function(){return N},s=2),Ke(e,{name:n,fromWireType:function(e){for(var n,i=N[e>>2],o=a(),u=e+4,c=0;c<=i;++c){var l=e+4+c*t;if(c==i||0==o[l>>s]){var f=r(u,l-u);void 0===n?n=f:(n+=String.fromCharCode(0),n+=f),u=l+t}}return dn(e),n},toWireType:function(e,r){"string"!=typeof r&&ye("Cannot pass non-string to C++ string type ".concat(n));var a=o(r),u=hn(4+a+t);return N[u>>2]=a>>s,i(r,u+4,a+t),null!==e&&e.push(dn,u),u},argPackAdvance:Je,readValueFromPointer:He,destructorFunction:function(e){dn(e)}})},J:function(e,t,n,r,i,a){Be[e]={name:Oe(t),rawConstructor:ht(n,r),rawDestructor:ht(i,a),fields:[]}},v:function(e,t,n,r,i,a,o,s,u,c){Be[e].fields.push({fieldName:Oe(t),getterReturnType:n,getter:ht(r,i),getterContext:a,setterArgumentType:o,setter:ht(s,u),setterContext:c})},Ea:function(e,t){Ke(e,{isVoid:!0,name:t=Oe(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},Fa:function(e){if(Jt.xhrs.has(e)){var t=Jt.xhrs.get(e);Jt.xhrs.free(e),t.readyState>0&&t.readyState<4&&t.abort()}},za:function(){return 1},Ta:function(e,t,n,r){return(e=Lt[e])(null,t=_e(t),n,r)},o:function(e,t,n,r,i){var a,o;return(e=Lt[e])(t=_e(t),t[n=void 0===(o=xt[a=n])?Oe(a):o],r,i)},a:wt,m:function(e,t,n){var r=function(e,t){for(var n=new Array(e),r=0;r<e;++r)n[r]=Le(N[t+4*r>>2],"parameter "+r);return n}(e,t),i=r.shift();e--;var a,o,s=new Array(e),u="methodCaller<(".concat(r.map(function(e){return e.name}).join(", "),") => ").concat(i.name,">");return a=me(u,function(t,a,o,u){for(var c=0,l=0;l<e;++l)s[l]=r[l].readValueFromPointer(u+c),c+=r[l].argPackAdvance;var f=1===n?kt(a,s):a.apply(t,s);return function(e,t,n){var r=[],i=e.toWireType(r,n);return r.length&&(N[t>>2]=be(r)),i}(i,o,f)}),o=Lt.length,Lt.push(a),o},S:function(e){e>4&&(ve.get(e).refcount+=1)},n:function(e){var t=_e(e);ze(t),wt(e)},L:function(e,t){var n=(e=Le(e,"_emval_take_value")).readValueFromPointer(t);return be(n)},Za:function(e,t,n){var r=jt(e,t),i=new Date(1e3*r);P[n>>2]=i.getUTCSeconds(),P[n+4>>2]=i.getUTCMinutes(),P[n+8>>2]=i.getUTCHours(),P[n+12>>2]=i.getUTCDate(),P[n+16>>2]=i.getUTCMonth(),P[n+20>>2]=i.getUTCFullYear()-1900,P[n+24>>2]=i.getUTCDay();var a=Date.UTC(i.getUTCFullYear(),0,1,0,0,0,0),o=(i.getTime()-a)/864e5|0;P[n+28>>2]=o},_a:function(e,t,n){var r=jt(e,t),i=new Date(1e3*r);P[n>>2]=i.getSeconds(),P[n+4>>2]=i.getMinutes(),P[n+8>>2]=i.getHours(),P[n+12>>2]=i.getDate(),P[n+16>>2]=i.getMonth(),P[n+20>>2]=i.getFullYear()-1900,P[n+24>>2]=i.getDay();var a=0|Ut(i);P[n+28>>2]=a,P[n+36>>2]=-60*i.getTimezoneOffset();var o=new Date(i.getFullYear(),0,1),s=new Date(i.getFullYear(),6,1).getTimezoneOffset(),u=o.getTimezoneOffset(),c=0|(s!=u&&i.getTimezoneOffset()==Math.min(u,s));P[n+32>>2]=c},$a:function(e){var t=function(){var t=new Date(P[e+20>>2]+1900,P[e+16>>2],P[e+12>>2],P[e+8>>2],P[e+4>>2],P[e>>2],0),n=P[e+32>>2],r=t.getTimezoneOffset(),i=new Date(t.getFullYear(),0,1),a=new Date(t.getFullYear(),6,1).getTimezoneOffset(),o=i.getTimezoneOffset(),s=Math.min(o,a);if(n<0)P[e+32>>2]=Number(a!=o&&s==r);else if(n>0!=(s==r)){var u=Math.max(o,a),c=n>0?s:u;t.setTime(t.getTime()+6e4*(c-r))}P[e+24>>2]=t.getDay();var l=0|Ut(t);P[e+28>>2]=l,P[e>>2]=t.getSeconds(),P[e+4>>2]=t.getMinutes(),P[e+8>>2]=t.getHours(),P[e+12>>2]=t.getDate(),P[e+16>>2]=t.getMonth(),P[e+20>>2]=t.getYear();var f=t.getTime();return isNaN(f)?-1:f/1e3}();return vn((Y=t,+Math.abs(Y)>=1?Y>0?+Math.floor(Y/4294967296)>>>0:~~+Math.ceil((Y-+(~~Y>>>0))/4294967296)>>>0:0)),t>>>0},Ya:function(e,t,n,r,i,a,o){},na:function(e,t,n){var r=(new Date).getFullYear(),i=new Date(r,0,1),a=new Date(r,6,1),o=i.getTimezoneOffset(),s=a.getTimezoneOffset(),u=Math.max(o,s);function c(e){var t=e.toTimeString().match(/\(([A-Za-z ]+)\)$/);return t?t[1]:"GMT"}N[e>>2]=60*u,P[t>>2]=Number(o!=s);var l=c(i),f=c(a),h=Wt(l),d=Wt(f);s<o?(N[n>>2]=h,N[n+4>>2]=d):(N[n>>2]=d,N[n+4>>2]=h)},R:function(){H("")},V:function(e,t,n){return Bt(e,t,n)},fa:function(e){clearInterval(e)},ga:zt,T:function(){return Date.now()},P:mt,Pa:function(e,t,n,r,i){Yt.existsFile(he(e),he(t),function(e,t){qt(function(){e?i&&lt(i)(n):r&&lt(r)(n,t)})})},Qa:function(e,t,n,r,i){Yt.getFile(he(e),he(t),function(e,t){qt(function(){if(e)i&&lt(i)(n);else{var a=hn(t.length);S.set(t,a),lt(r)(n,a,t.length),dn(a)}})})},Ra:function(e,t,n,r,i,a,o){Yt.setFile(he(e),he(t),new Uint8Array(S.subarray(n,n+r)),function(e){qt(function(){e?o&&lt(o)(i):a&&lt(a)(i)})})},Ha:function(){return!0},Aa:Kt,ma:function(e){S.length,H("OOM")},Ga:function(e,t,n,r,i){var a=e+112,o=N[a+36>>2],s=N[a+40>>2];N[a+44>>2],N[a+48>>2];var u=!!(64&N[a+52>>2]);function c(e){u?e():qt(e)}return Xt(e,function(e,n,r){c(function(){o?lt(o)(e):null==t||t(e)})},function(e,t,r){c(function(){s?lt(s)(e):null==n||n(e)})}),e},sa:function(e,t){var n=0;return en().forEach(function(r,i){var a=t+n;N[e+4*i>>2]=a,function(e,t){for(var n=0;n<e.length;++n)C[0|t++]=e.charCodeAt(n);C[0|t]=0}(r,a),n+=r.length+1}),0},ta:function(e,t){var n=en();N[e>>2]=n.length;var r=0;return n.forEach(function(e){return r+=e.length+1}),N[t>>2]=r,0},Q:function(e){return 52},$:function(e,t,n,r){return 52},ab:function(e,t,n,r,i){return 70},aa:function(e,t,n,r){for(var i=0,a=0;a<n;a++){var o=N[t>>2],s=N[t+4>>2];t+=8;for(var u=0;u<s;u++)nn(e,S[o+u]);i+=s}return N[r>>2]=i,0},Sa:function(){var e,t,n,r,i="";return globalThis&&globalThis.navigator&&(i=globalThis.navigator.userAgent.toLowerCase()),e=globalThis&&"wx"===globalThis.__ALIVC_IM_PLATFORM__?function(){var e={os:"wx"};if("undefined"!=typeof wx){if(wx.getDeviceInfo){var t=wx.getDeviceInfo();t&&(t.platform&&(e.tt=t.platform),t.model&&(e.dm=t.model),t.brand&&(e.db=t.brand))}if(wx.getAppBaseInfo){var n=wx.getAppBaseInfo();n&&(n.version&&(e.osv=n.version),n.SDKVersion&&(e.wx_sdkversion=n.SDKVersion))}var r={};if("undefined"!=typeof __wxConfig&&__wxConfig.accountInfo)r=__wxConfig.accountInfo;else if(wx.getAccountInfoSync){var i=wx.getAccountInfoSync();i&&i.miniProgram&&(r=i.miniProgram)}r.appId&&(e.wx_appid=r.appId),r.nickname&&(e.wx_appname=r.nickname)}return e}():function(e){var t={os:"web"},n="",r="";try{/Windows NT (\d+\.\d+)/i.test(e)?(r="Windows",n=e.match(/Windows NT (\d+\.\d+)/i)[1]):/Mac OS X (\d+[\.\_]\d+[\.\_]\d+)/i.test(e)?(r="macOS",n=e.match(/Mac OS X (\d+[\.\_]\d+[\.\_]\d+)/i)[1].replace(/_/g,".")):/Mac OS X (\d+[\.\_]\d+)/i.test(e)?(r="macOS",n=e.match(/Mac OS X (\d+[\.\_]\d+)/i)[1].replace(/_/g,".")):/Android (\d+\.\d+)/i.test(e)?(r="Android",n=e.match(/Android (\d+\.\d+)/i)[1]):/iPhone OS (\d+_\d+)/i.test(e)?(r="iOS",n=e.match(/iPhone OS (\d+_\d+)/i)[1].replace(/_/g,".")):/iPad.*OS (\d+_\d+)/i.test(e)&&(r="iOS",n=e.match(/iPad.*OS (\d+_\d+)/i)[1].replace(/_/g,"."))}catch(e){}t.tt=r,t.osv=n;for(var i="",a="",o=[[/(opera|opr)[\/\s](\d+(\.\d+)?)/i,"Opera"],[/(edge|edg)[\/\s](\d+(\.\d+)?)/i,"Edge"],[/(chrome)[\/\s](\d+(\.\d+)?)/i,"Chrome"],[/(safari)[\/\s](\d+(\.\d+)?)/i,"Safari"],[/(firefox)[\/\s](\d+(\.\d+)?)/i,"Firefox"],[/(msie|trident)[\/\s]?(\d+(\.\d+)?)/i,"Internet Explorer"]],s=0;s<o.length;s++){var u=e.match(o[s][0]);if(u){a=o[s][1],i=u[2];break}}t.db=a,t.dm=i,t.appname=globalThis._core||"",t.appver=globalThis._transport||"";var c=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return c&&(t.nt=c.effectiveType||""),t}(i),t=JSON.stringify(e),n=Et(t)+1,r=hn(n),pe(t,r,n),r},ja:function(e,t){return rn(S.subarray(e,e+t)),0},W:function(e,t,n,r){var i=yn();try{return lt(e)(t,n,r)}catch(e){if(wn(i),e!==e+0)throw e;gn(1,0)}},X:function(e,t,n,r){var i=yn();try{return lt(e)(t,n,r)}catch(e){if(wn(i),e!==e+0)throw e;gn(1,0)}},x:function(e){var t=yn();try{return lt(e)()}catch(e){if(wn(t),e!==e+0)throw e;gn(1,0)}},d:function(e,t){var n=yn();try{return lt(e)(t)}catch(e){if(wn(n),e!==e+0)throw e;gn(1,0)}},i:function(e,t,n){var r=yn();try{return lt(e)(t,n)}catch(e){if(wn(r),e!==e+0)throw e;gn(1,0)}},y:function(e,t,n,r){var i=yn();try{return lt(e)(t,n,r)}catch(e){if(wn(i),e!==e+0)throw e;gn(1,0)}},t:function(e,t,n,r,i){var a=yn();try{return lt(e)(t,n,r,i)}catch(e){if(wn(a),e!==e+0)throw e;gn(1,0)}},K:function(e,t,n,r,i,a){var o=yn();try{return lt(e)(t,n,r,i,a)}catch(e){if(wn(o),e!==e+0)throw e;gn(1,0)}},H:function(e,t,n,r,i,a,o){var s=yn();try{return lt(e)(t,n,r,i,a,o)}catch(e){if(wn(s),e!==e+0)throw e;gn(1,0)}},Y:function(e,t,n,r,i,a,o,s){var u=yn();try{return lt(e)(t,n,r,i,a,o,s)}catch(e){if(wn(u),e!==e+0)throw e;gn(1,0)}},O:function(e,t,n,r,i,a,o,s,u,c,l,f){var h=yn();try{return lt(e)(t,n,r,i,a,o,s,u,c,l,f)}catch(e){if(wn(h),e!==e+0)throw e;gn(1,0)}},Va:function(e,t,n,r,i,a,o){var s=yn();try{return Sn(e,t,n,r,i,a,o)}catch(e){if(wn(s),e!==e+0)throw e;gn(1,0)}},Xa:function(e){var t=yn();try{return Tn(e)}catch(e){if(wn(t),e!==e+0)throw e;gn(1,0)}},Ua:function(e,t,n,r,i){var a=yn();try{return An(e,t,n,r,i)}catch(e){if(wn(a),e!==e+0)throw e;gn(1,0)}},s:function(e){var t=yn();try{lt(e)()}catch(e){if(wn(t),e!==e+0)throw e;gn(1,0)}},D:function(e,t){var n=yn();try{lt(e)(t)}catch(e){if(wn(n),e!==e+0)throw e;gn(1,0)}},e:function(e,t,n){var r=yn();try{lt(e)(t,n)}catch(e){if(wn(r),e!==e+0)throw e;gn(1,0)}},ha:function(e,t,n,r){var i=yn();try{lt(e)(t,n,r)}catch(e){if(wn(i),e!==e+0)throw e;gn(1,0)}},ia:function(e,t,n,r){var i=yn();try{lt(e)(t,n,r)}catch(e){if(wn(i),e!==e+0)throw e;gn(1,0)}},B:function(e,t,n,r){var i=yn();try{lt(e)(t,n,r)}catch(e){if(wn(i),e!==e+0)throw e;gn(1,0)}},Z:function(e,t,n,r,i){var a=yn();try{lt(e)(t,n,r,i)}catch(e){if(wn(a),e!==e+0)throw e;gn(1,0)}},F:function(e,t,n,r,i,a,o,s){var u=yn();try{lt(e)(t,n,r,i,a,o,s)}catch(e){if(wn(u),e!==e+0)throw e;gn(1,0)}},M:function(e,t,n,r,i,a,o,s,u,c,l){var f=yn();try{lt(e)(t,n,r,i,a,o,s,u,c,l)}catch(e){if(wn(f),e!==e+0)throw e;gn(1,0)}},N:function(e,t,n,r,i,a,o,s,u,c,l,f,h,d,p,m){var g=yn();try{lt(e)(t,n,r,i,a,o,s,u,c,l,f,h,d,p,m)}catch(e){if(wn(g),e!==e+0)throw e;gn(1,0)}},Wa:function(e,t,n,r,i,a,o){var s=yn();try{Cn(e,t,n,r,i,a,o)}catch(e){if(wn(s),e!==e+0)throw e;gn(1,0)}},Ma:function(e,t,n,r,i,a){var o=he(t),s=S.subarray(i,i+a);g.sendData&&g.sendData(e,o,n,r,s)},Ja:function(e,t){var n=he(e),r=he(t);g.subscribe&&g.subscribe(n,r)},Ia:function(e,t){var n=he(e),r=he(t);g.unSubscribe&&g.unSubscribe(n,r)},La:function(e,t,n){var r=he(t),i=he(n);g.sendData&&g.sendData(e,r,0,!1,i)},Ka:function(e,t,n,r,i,a){var o=he(t),s=S.subarray(i,i+a);g.sendStream&&g.sendStream(e,o,s)},ka:function(e,t,n,r,i){return un(e,t,n,r)},Oa:function(e){var t=null;if(void 0!==window.crypto&&void 0!==window.crypto.getRandomValues&&(t=new Uint8Array(16),window.crypto.getRandomValues(t)),!t){t=new Array(16);for(var n=(new Date).getTime(),r=0;r<16;r++){var i=(n+256*Math.random())%256|0;n=n/256|0,t[r]=i}}t[6]=15&t[6]|64,t[8]=63&t[8]|128,sn(t,e)},Na:function(e,t,n){var r=0,i="xxxx-xx-xx-xx-xxxxxx".replace(/[x]/g,function(t){var i=n?S[e+r|0].toString(16).toUpperCase():S[e+r|0].toString(16);return i=1===i.length?"0"+i:i,r++,i});pe(i,t,37)}},fn=function(){var e,t,n,r,i,a={a:ln};function o(e,t){var n,r;return fn=e.exports,O=fn.cb,n=O.buffer,g.HEAP8=C=new Int8Array(n),g.HEAP16=A=new Int16Array(n),g.HEAPU8=S=new Uint8Array(n),g.HEAPU16=M=new Uint16Array(n),g.HEAP32=P=new Int32Array(n),g.HEAPU32=N=new Uint32Array(n),g.HEAPF32=L=new Float32Array(n),g.HEAPF64=x=new Float64Array(n),ut=fn.eb,r=fn.db,D.unshift(r),function(){var e;if(B--,null===(e=g.monitorRunDependencies)||void 0===e||e.call(g,B),0==B&&z){var t=z;z=null,t()}}(),fn}if(B++,null===(e=g.monitorRunDependencies)||void 0===e||e.call(g,B),g.instantiateWasm)try{return g.instantiateWasm(a,o)}catch(e){E("Module.instantiateWasm callback failed with error: ".concat(e)),m(e)}return(t=R,n=V,r=a,i=function(e){o(e.instance)},t||"function"!=typeof WebAssembly.instantiateStreaming||K(n)||"function"!=typeof fetch?J(n,r,i):fetch(n,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,r).then(i,function(e){return E("wasm streaming compile failed: ".concat(e)),E("falling back to ArrayBuffer instantiation"),J(n,r,i)})})).catch(m),{}}(),hn=g._malloc=function(e){return(hn=g._malloc=fn.fb)(e)},dn=g._free=function(e){return(dn=g._free=fn.gb)(e)},pn=g._main=function(e,t){return(pn=g._main=fn.hb)(e,t)},mn=function(e){return(mn=fn.ib)(e)},gn=function(e,t){return(gn=fn.jb)(e,t)},vn=function(e){return(vn=fn.kb)(e)},yn=function(){return(yn=fn.lb)()},wn=function(e){return(wn=fn.mb)(e)},_n=function(e){return(_n=fn.nb)(e)},bn=function(e){return(bn=fn.ob)(e)},Rn=function(e){return(Rn=fn.pb)(e)},On=function(e,t,n){return(On=fn.qb)(e,t,n)},In=function(e){return(In=fn.rb)(e)};g.dynCall_viiijjiii=function(e,t,n,r,i,a,o,s,u,c,l){return(g.dynCall_viiijjiii=fn.sb)(e,t,n,r,i,a,o,s,u,c,l)},g.dynCall_iiiiji=function(e,t,n,r,i,a,o){return(g.dynCall_iiiiji=fn.tb)(e,t,n,r,i,a,o)},g.dynCall_iiijii=function(e,t,n,r,i,a,o){return(g.dynCall_iiijii=fn.ub)(e,t,n,r,i,a,o)},g.dynCall_iiiijiijj=function(e,t,n,r,i,a,o,s,u,c,l,f){return(g.dynCall_iiiijiijj=fn.vb)(e,t,n,r,i,a,o,s,u,c,l,f)},g.dynCall_viijjiii=function(e,t,n,r,i,a,o,s,u,c){return(g.dynCall_viijjiii=fn.wb)(e,t,n,r,i,a,o,s,u,c)},g.dynCall_jiiiiiii=function(e,t,n,r,i,a,o,s){return(g.dynCall_jiiiiiii=fn.xb)(e,t,n,r,i,a,o,s)},g.dynCall_viiiij=function(e,t,n,r,i,a,o){return(g.dynCall_viiiij=fn.yb)(e,t,n,r,i,a,o)},g.dynCall_viiji=function(e,t,n,r,i,a){return(g.dynCall_viiji=fn.zb)(e,t,n,r,i,a)},g.dynCall_viiij=function(e,t,n,r,i,a){return(g.dynCall_viiij=fn.Ab)(e,t,n,r,i,a)},g.dynCall_jiii=function(e,t,n,r){return(g.dynCall_jiii=fn.Bb)(e,t,n,r)},g.dynCall_vij=function(e,t,n,r){return(g.dynCall_vij=fn.Cb)(e,t,n,r)},g.dynCall_ji=function(e,t){return(g.dynCall_ji=fn.Db)(e,t)},g.dynCall_jiji=function(e,t,n,r,i){return(g.dynCall_jiji=fn.Eb)(e,t,n,r,i)};var En,Tn=g.dynCall_j=function(e){return(Tn=g.dynCall_j=fn.Fb)(e)},Cn=g.dynCall_viijii=function(e,t,n,r,i,a,o){return(Cn=g.dynCall_viijii=fn.Gb)(e,t,n,r,i,a,o)},Sn=g.dynCall_iiiiij=function(e,t,n,r,i,a,o){return(Sn=g.dynCall_iiiiij=fn.Hb)(e,t,n,r,i,a,o)},An=g.dynCall_jiiii=function(e,t,n,r,i){return(An=g.dynCall_jiiii=fn.Ib)(e,t,n,r,i)};function Mn(){function e(){En||(En=!0,g.calledRun=!0,k||(Z(D),Z(F),p(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),Pn&&function(){var e=pn;try{var t=e(0,0);return Vt(t),t}catch(e){return Ht(e)}}(),function(){if(g.postRun)for("function"==typeof g.postRun&&(g.postRun=[g.postRun]);g.postRun.length;)W(g.postRun.shift());Z($)}()))}B>0||(function(){if(g.preRun)for("function"==typeof g.preRun&&(g.preRun=[g.preRun]);g.preRun.length;)U(g.preRun.shift());Z(j)}(),B>0||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("")},1),e()},1)):e()))}if(g.dynCall_iiiiijj=function(e,t,n,r,i,a,o,s,u){return(g.dynCall_iiiiijj=fn.Jb)(e,t,n,r,i,a,o,s,u)},g.dynCall_iiiiiijj=function(e,t,n,r,i,a,o,s,u,c){return(g.dynCall_iiiiiijj=fn.Kb)(e,t,n,r,i,a,o,s,u,c)},g.ccall=function(e,t,n,r,i){var a={string:function(e){var t=0;return null!=e&&0!==e&&(t=function(e){var t=Et(e)+1,n=_n(t);return pe(e,n,t),n}(e)),t},array:function(e){var t=_n(e.length);return sn(e,t),t}},o=function(e){return g["_"+e]}(e),s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=a[n[c]];l?(0===u&&(u=yn()),s[c]=l(r[c])):s[c]=r[c]}var f,h=o.apply(null,s);return f=h,0!==u&&wn(u),h=function(e){return"string"===t?he(e):"boolean"===t?Boolean(e):e}(f),h},g.UTF8ToString=he,g.allocate=function(e,t){var n;return n=1==t?_n(e.length):hn(e.length),e.subarray||e.slice||(e=new Uint8Array(e)),S.set(e,n),n},g.allocateUTF8=cn,z=function e(){En||Mn(),En||(z=e)},g.preInit)for("function"==typeof g.preInit&&(g.preInit=[g.preInit]);g.preInit.length>0;)g.preInit.pop()();var Pn=!0;return g.noInitialRun&&(Pn=!1),Mn(),g.wasmOnReceiveData=function(e,t){if(t instanceof Uint8Array){var n=hn(t.length);S.set(t,n),g.TransportDataHandler.OnReceiveData(e,n,t.length)}else g.TransportDataHandler.OnReceiveMessage(e,t)},g.wasmOnConnectResult=function(e,t,n){g.TransportDataHandler.OnConnectResult(e,t,n)},g.wasmOnConnectionLostEvent=function(e,t){g.TransportDataHandler.OnConnectionLostEvent(e,t)},g.wasmOnIpSwitchEvent=function(e,t){g.TransportDataHandler.OnIpSwitchEvent(e,t)},g.wasmOnConnectionEvent=function(e){g.TransportDataHandler.OnConnectionEvent(e)},e.ready});(h=f||(f={}))[h.ASC=0]="ASC",h[h.DESC=1]="DESC";var m=f;const g=(e,t)=>(null==e?void 0:e.value)||t,v=e=>{const t=[];for(var n=0;n<e.size();n++)t.push(e.get(n));return t},y=e=>{const t={},n=e.keys();for(var r=0;r<n.size();r++){const i=n.get(r);t[i]=e.get(i)}return n.delete(),t},w=(e,t)=>{const n=t.values[e];if(n)return n},_=e=>!!e||0===e,b=(e,t,n)=>{const r=Array.isArray(t)?t:t.replace(/\[(\d+)\]/g,".$1").split(".");let i=e;for(const e of r)if(i=null!=i?i[e]:void 0,void 0===i)return n;return i},R=(e,t,n)=>!n.required||null!=t&&""!==t?n.type&&typeof t!==n.type?`Property "${e}" should be of type "${n.type}".`:void 0!==n.minLength&&"string"==typeof t&&t.length<n.minLength?`Property "${e}" should have at least ${n.minLength} characters.`:void 0!==n.maxLength&&"string"==typeof t&&t.length>n.maxLength?`Property "${e}" should have at most ${n.maxLength} characters.`:void 0!==n.min&&"number"==typeof t&&t<n.min?`Property "${e}" value cannot be less than ${n.min}.`:void 0!==n.max&&"number"==typeof t&&t>n.max?`Property "${e}" value cannot be greater than ${n.max}.`:"":`Property "${e}" is required.`;function O(e,t=[]){if("object"==typeof e&&"object"==typeof e.$$&&"function"==typeof e.delete){for(const n in e)if(!t.includes(n))try{O(e[n])}catch(e){}e.delete()}}function I(e){e.forEach(e=>{try{O(e)}catch(e){}})}const E={groupId:"",type:0,nextpagetoken:0,sortType:m.ASC,pageSize:10},T={groupId:"",seqnum:0,pageSize:50};var C,S;(S=C||(C={}))[S.NORMAL=0]="NORMAL",S[S.MEDIUM=1]="MEDIUM",S[S.HIGH=2]="HIGH";var A=C;const M={userId:"",userExtension:""},P=e=>({userId:e.user_id,userExtension:e.user_extension}),N=e=>{const t=[];for(var n=0;n<e.size();n++)t.push(P(e.get(n)));return t};A.NORMAL;const L=e=>({groupId:e.group_id,messageId:e.message_id,type:e.type,sender:e.sender?P(e.sender):void 0,data:e.data,seqnum:+e.seqnum,timestamp:+e.timestamp,level:g(e.level,A.NORMAL),repeatCount:e.repeat_count,totalMsgs:e.total_msgs}),x={groupId:"",type:0,data:"",skipMuteCheck:!1,skipAudit:!1,level:A.NORMAL,noStorage:!1,repeatCount:1},k={type:0,data:"",receiverId:"",skipAudit:!1,level:A.NORMAL};class j extends Error{constructor(e,t){super(`${t?"code:"+t+";msg:":""}${e}`),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"msg",{enumerable:!0,configurable:!0,writable:!0,value:""}),this.name="IMError",t&&(this.code=t),this.msg=e}static fromWASMError(e){const t=e.code,n=e.msg;return new j(n,t)}}const D={groupId:"",type:0,nextPageToken:0,sortType:m.ASC,pageSize:10,beginTime:0,endTime:0};var F,$,U,W,G,B,z,H;($=F||(F={}))[$.NORMAL=0]="NORMAL",(W=U||(U={}))[W.SERVER=0]="SERVER",(B=G||(G={}))[B.TEXT=1]="TEXT",B[B.BINARY_FILE=2]="BINARY_FILE",(H=z||(z={}))[H.CONTINUE=0]="CONTINUE",H[H.START=1]="START",H[H.END=2]="END",H[H.ALL=3]="ALL",H[H.CANCEL=4]="CANCEL";var V,q;(q=V||(V={}))[q.IMAGE=1]="IMAGE",q[q.AUDIO=2]="AUDIO",q[q.VIDEO=3]="VIDEO",q[q.OTHER=4]="OTHER";const Y=(e,t)=>({id:t.id,file_type:e.ImAttachmentType.values[t.fileType],file_size:t.fileSize,file_name:t.fileName,file_duration:t.fileDuration,access_key:t.accessKey,extra:t.extra});class K extends d{constructor(e){super(),Object.defineProperty(this,"wasmIns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sender",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.wasmIns=e}setSender(e){this.sender=e}getMessageId(){var e;return null===(e=this.sender)||void 0===e?void 0:e.GetMessageId()}sendByteData(e,t,n){if(!this.sender)return;const r=new this.wasmIns.VectorImAttachment;n&&n.forEach(e=>{const t=Y(this.wasmIns,e);r.push_back(t)});const i=new this.wasmIns.ImStreamData,a=e.byteLength,o=this.wasmIns._malloc(a);this.wasmIns.HEAPU8.set(e,o),i.setBufferByPtr(o,a);const s=i.byteData;this.sender.SendByteData(s,t,r),I([i,s,r])}cancel(e,t){var n;null===(n=this.sender)||void 0===n||n.Cancel(e,t)}destroy(){var e;null===(e=this.sender)||void 0===e||e.delete(),this.sender=void 0,this.removeAllListeners()}}class J{constructor(e,t){Object.defineProperty(this,"wasmIns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wasmMessageManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.wasmIns=e,this.wasmMessageManager=t}createStreamMessage(e){const t=this,n=new K(this.wasmIns);return new Promise((r,i)=>{var a,o;const s=this.wasmIns.ImStreamMessageSenderCallbackWrapper.implement({OnSuccess(e){const i=t.wasmIns.ImStreamMessageSender.CopyPtr(e);n.setSender(i),r(n)},OnFailure(e){n.destroy(),i(j.fromWASMError(e))}}),u=this.wasmIns.OnStreamListenerWrapper.implement({OnStreamEnd(e,t,r,i){console.log("OnStreamEnd",e,t,r,i),n.emit("streammessageend",e,t,r,i)}});this.wasmMessageManager.CreateStreamMessage(e.receiverId,u,s,null!==(a=e.dataType)&&void 0!==a?a:G.TEXT,null!==(o=e.receiverType)&&void 0!==o?o:U.SERVER,F.NORMAL),I([s,u])})}}var X=function(e,t,n,r){return new(n||(n=Promise))(function(t,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(a,o)}s((r=r.apply(e,[])).next())})};class Q extends d{constructor(e,t){super(),Object.defineProperty(this,"wasmIns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wasmMessageManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageListener",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamMessageManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.wasmIns=e,this.wasmMessageManager=t.GetMessageManager(),this.streamMessageManager=new J(this.wasmIns,this.wasmMessageManager)}addMessageListener(){this.messageListener=this.wasmIns.ImMessageListenerWrapper.implement({OnRecvC2cMessage:e=>{this.emit("recvc2cmessage",L(e))},OnRecvGroupMessage:(e,t)=>{this.emit("recvgroupmessage",L(e),t)},OnDeleteGroupMessage:(e,t)=>{this.emit("deletegroupmessage",e,t)},OnReceiveStreamMessage:e=>{this.emit("recvstreammessage",((e,t)=>{const n=t.getStreamDataSize(),r=t.getStreamDataByPtr(),i=e.HEAPU8.subarray(r,r+n),a=new Uint8Array(i),o=t.data;let s;return o&&(s=o.seqNum,o.delete()),{messageId:t.messageId,sender:{userId:t.userId},data:{seqNum:s,byteData:a}}})(this.wasmIns,e))},OnStreamMessageEnd:(e,t,n,r)=>{this.emit("streammessageend",e,t,n,r)}}),this.wasmMessageManager.AddMessageListener(this.messageListener)}removeMessageListener(){this.messageListener&&(this.wasmMessageManager&&this.wasmMessageManager.RemoveMessageListener(this.messageListener),this.messageListener.delete(),this.messageListener=null)}destroy(){this.removeMessageListener(),this.removeAllListeners(),this.wasmMessageManager&&(this.wasmMessageManager.delete(),this.wasmMessageManager=null)}sendC2cMessage(e){return X(this,0,void 0,function*(){const t=((e,t)=>{const n=new e.ImSendMessageToUserReq,r=Object.assign(Object.assign({},k),t);if(n.type=r.type,n.data=r.data,n.receiver_id=r.receiverId,n.skip_audit=r.skipAudit,r.level||0===r.level){const t=e.ImMessageLevel.values[r.level];t&&(n.level=t)}return n})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImSendMessageToUserRspCallbackWrapper.implement({OnSuccess(t){e(t.message_id)},OnFailure(e){n(j.fromWASMError(e))}});this.wasmMessageManager.SendC2cMessage(t,r),I([t,r])})})}sendGroupMessage(e){return X(this,0,void 0,function*(){const t=((e,t)=>{const n=new e.ImSendMessageToGroupReq,r=Object.assign(Object.assign({},x),t);if(n.type=r.type,n.data=r.data,n.group_id=r.groupId,n.skip_mute_check=r.skipMuteCheck,n.skip_audit=r.skipAudit,r.level||0===r.level){const t=e.ImMessageLevel.values[r.level];t&&(n.level=t)}return r.noStorage&&(n.no_storage=r.noStorage),r.repeatCount&&r.repeatCount>0&&(n.repeat_count=r.repeatCount),n})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImSendMessageToGroupRspCallbackWrapper.implement({OnSuccess(t){e(t.message_id)},OnFailure(e){n(j.fromWASMError(e))}});this.wasmMessageManager.SendGroupMessage(t,r),I([t,r])})})}listMessage(e){return X(this,0,void 0,function*(){const t=((e,t)=>{const n=new e.ImListMessageReq;_(t.nextpagetoken)&&!_(t.nextPageToken)&&(t.nextPageToken=t.nextpagetoken);const r=Object.assign(Object.assign({},E),t);return n.group_id=r.groupId,n.type=r.type,_(r.nextPageToken)&&n.setNextPageToken(r.nextPageToken.toString()),(r.sortType||0===r.sortType)&&(n.sort_type=w(r.sortType,e.ImSortType)),n.page_size=r.pageSize,r.beginTime&&r.beginTime>0&&n.setBeginTime(r.beginTime.toString()),r.endTime&&r.endTime>0&&n.setEndTime(r.endTime.toString()),n})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImListMessageRspCallbackWrapper.implement({OnSuccess(t){e((e=>{const t=[],n=e.message_list;for(var r=0;r<n.size();r++)t.push(L(n.get(r)));n.delete();const i=+e.getNextPageToken();return{groupId:e.group_id,nextPageToken:i,nextpagetoken:i,hasMore:e.has_more,messageList:t}})(t))},OnFailure(e){n(j.fromWASMError(e))}});this.wasmMessageManager.ListMessage(t,r),I([t,r])})})}listRecentMessage(e){const t=((e,t)=>{let n="string"==typeof t?{groupId:t}:t;const r=new e.ImListRecentMessageReq,i=Object.assign(Object.assign({},T),n);return r.group_id=i.groupId,r.seqnum=i.seqnum,r.page_size=i.pageSize,r})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImListRecentMessageRspCallbackWrapper.implement({OnSuccess(t){e((e=>{const t=[],n=e.message_list;for(var r=0;r<n.size();r++)t.push(L(n.get(r)));return n.delete(),{groupId:e.group_id,messageList:t}})(t))},OnFailure(e){n(j.fromWASMError(e))}});this.wasmMessageManager.ListRecentMessage(t,r),I([t,r])})}listHistoryMessage(e){const t=((e,t)=>{const n=new e.ImListHistoryMessageReq,r=Object.assign(Object.assign({},D),t);return n.group_id=r.groupId,n.type=r.type,_(r.nextPageToken)&&n.setNextPageToken(r.nextPageToken.toString()),(r.sortType||0===r.sortType)&&(n.sort_type=w(r.sortType,e.ImSortType)),n.page_size=r.pageSize,(r.beginTime||0===r.beginTime)&&n.setBeginTime(r.beginTime.toString()),(r.endTime||0===r.endTime)&&n.setEndTime(r.endTime.toString()),n})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImListHistoryMessageRspCallbackWrapper.implement({OnSuccess(t){e((e=>{const t=[],n=e.message_list;for(var r=0;r<n.size();r++)t.push(L(n.get(r)));return n.delete(),{groupId:e.group_id,nextPageToken:+e.getNextPageToken(),hasMore:e.has_more,messageList:t}})(t))},OnFailure(e){n(j.fromWASMError(e))}});this.wasmMessageManager.ListHistoryMessage(t,r),I([t,r])})}deleteMessage(e){const t=(n=this.wasmIns,r=e,new n.ImDeleteMessageReq(r.groupId,r.messageId,""));var n,r;return new Promise((e,n)=>{const r=this.wasmIns.ImSdkCallback.implement({OnSuccess(){e()},OnFailure(e){n(j.fromWASMError(e))}});this.wasmMessageManager.DeleteMessage(t,r),I([t,r])})}createStreamMessage(e){return this.streamMessageManager.createStreamMessage(e)}rejectStreamMessage(e){return new Promise((t,n)=>{const r=this.wasmIns.ImSdkCallback.implement({OnSuccess(){t()},OnFailure(e){n(j.fromWASMError(e))}});this.wasmMessageManager.RejectStreamMessage(e.messageId,e.receiverType||U.SERVER,e.code||0,e.msg||"",r),I([r])})}forwardCustomMessage(e){return new Promise((t,n)=>{const r=this.wasmIns.ImForwardMessageRspCallbackWrapper.implement({OnSuccess(e){t({messageId:e.messageId,data:e.data})},OnFailure(e){n(j.fromWASMError(e))}});this.wasmMessageManager.ForwardCustomMessage(e.receiverId,e.data,r),I([r])})}}const Z={groupId:"",groupName:"",groupMeta:""},ee={groupId:"",forceUpdateGroupMeta:!1,groupMeta:"",forceUpdateAdmins:!1,admins:[]},te={groupId:"",sortType:m.ASC,pageSize:30},ne=e=>{const t=e.mute_user_list,n=e.white_user_list,r={groupId:e.group_id,muteAll:e.mute_all,muteUserList:v(t),whiteUserList:v(n)};return null==t||t.delete(),null==n||n.delete(),r},re=e=>{const t=e.msg_amount,n={pv:e.pv,onlineCount:e.online_count,msgAmount:y(t)};return null==t||t.delete(),n},ie=e=>{const t=e.admins,n={groupId:e.group_id,groupName:e.group_name,groupMeta:e.group_meta,createTime:+e.create_time,creator:e.creator,admins:t?v(t):[],statistics:re(e.statistics),muteStatus:ne(e.mute_status),isBigGroup:e.isBigGroup};return null==t||t.delete(),n};var ae=function(e,t,n,r){return new(n||(n=Promise))(function(t,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(a,o)}s((r=r.apply(e,[])).next())})};class oe extends d{constructor(e,t){super(),Object.defineProperty(this,"wasmIns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wasmGroupManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"groupListener",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.wasmIns=e,this.wasmGroupManager=t.GetGroupManager()}addGroupListener(){this.groupListener=this.wasmIns.ImGroupListenerWrapper.implement({OnMemberChange:(e,t,n,r,i,a)=>{this.emit("memberchange",e,Number.parseInt(t)||0,N(i),N(a)),this.emit("memberdatachange",{groupId:e,onlineCount:Number.parseInt(t)||0,pv:Number.parseInt(n)||0,isBigGroup:r,joinUsers:N(i),leaveUsers:N(a)})},OnExit:(e,t)=>{this.emit("exit",e,t)},OnMuteChange:(e,t)=>{this.emit("mutechange",e,ne(t))},OnInfoChange:(e,t)=>{this.emit("infochange",e,(e=>{const t=e.admin_list,n={groupId:e.group_id,groupMeta:e.group_meta,adminList:t?v(t):[]};return null==t||t.delete(),n})(t))}}),this.wasmGroupManager.AddGroupListener(this.groupListener)}removeGroupListener(){this.groupListener&&(this.wasmGroupManager&&this.wasmGroupManager.RemoveGroupListener(this.groupListener),this.groupListener.delete(),this.groupListener=null)}destroy(){this.removeGroupListener(),this.removeAllListeners(),this.wasmGroupManager&&(this.wasmGroupManager.delete(),this.wasmGroupManager=null)}createGroup(e){return ae(this,0,void 0,function*(){const t=((e,t)=>{const n=new e.ImCreateGroupReq,r=Object.assign(Object.assign({},Z),t);return n.group_id=r.groupId,n.group_name=r.groupName,n.group_meta=r.groupMeta,n})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImCreateGroupRspCallbackWrapper.implement({OnSuccess(t){var n;e({groupId:(n=t).group_id,alreadyExist:n.already_exist})},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.CreateGroup(t,r),I([t,r])})})}queryGroup(e){return ae(this,0,void 0,function*(){const t="string"==typeof e?new this.wasmIns.ImQueryGroupReq(e):(n=this.wasmIns,r=e,new n.ImQueryGroupReq(r.groupId));var n,r;return new Promise((e,n)=>{const r=this.wasmIns.ImQueryGroupRspCallbackWrapper.implement({OnSuccess(t){e(ie(t.group_info))},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.QueryGroup(t,r),I([t,r])})})}closeGroup(e){return ae(this,0,void 0,function*(){const t="string"==typeof e?new this.wasmIns.ImCloseGroupReq(e):(n=this.wasmIns,r=e,new n.ImCloseGroupReq(r.groupId));var n,r;return new Promise((e,n)=>{const r=this.wasmIns.ImSdkCallbackWrapper.implement({OnSuccess(){e()},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.CloseGroup(t,r),I([t,r])})})}joinGroup(e){return ae(this,0,void 0,function*(){const t="string"==typeof e?new this.wasmIns.ImJoinGroupReq(e):(n=this.wasmIns,r=e,new n.ImJoinGroupReq(r.groupId));var n,r;return new Promise((e,n)=>{const r=this.wasmIns.ImJoinGroupRspCallbackWrapper.implement({OnSuccess(t){e(ie(t.group_info))},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.JoinGroup(t,r),I([t,r])})})}leaveGroup(e){return ae(this,0,void 0,function*(){const t="string"==typeof e?new this.wasmIns.ImLeaveGroupReq(e):(n=this.wasmIns,r=e,new n.ImLeaveGroupReq(r.groupId));var n,r;return new Promise((e,n)=>{const r=this.wasmIns.ImSdkCallbackWrapper.implement({OnSuccess(){e()},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.LeaveGroup(t,r),I([t,r])})})}modifyGroup(e){return ae(this,0,void 0,function*(){const t=((e,t)=>{const n=new e.ImModifyGroupReq,r=Object.assign(Object.assign({},ee),t);n.group_id=r.groupId,n.force_update_group_meta=r.forceUpdateGroupMeta,n.group_meta=r.groupMeta,n.force_update_admins=r.forceUpdateAdmins;const i=new e.VectorString;return r.admins&&r.admins.forEach(e=>{i.push_back(e)}),n.admins=i,i.delete(),n})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImSdkCallbackWrapper.implement({OnSuccess(){e()},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.ModifyGroup(t,r),I([t,r])})})}listRecentGroupUser(e){return ae(this,0,void 0,function*(){var t,n,r="string"==typeof e?new this.wasmIns.ImListRecentGroupUserReq(e):(t=this.wasmIns,n=e,new t.ImListRecentGroupUserReq(n.groupId));return new Promise((e,t)=>{const n=this.wasmIns.ImListRecentGroupUserRspCallbackWrapper.implement({OnSuccess(t){e((e=>{const t=[],n=e.user_list;for(var r=0;r<n.size();r++)t.push(P(n.get(r)));return n.delete(),{groupId:e.group_id,total:e.total,userList:t}})(t))},OnFailure(e){t(j.fromWASMError(e))}});this.wasmGroupManager.ListRecentGroupUser(r,n),I([r,n])})})}listGroupUser(e){return ae(this,0,void 0,function*(){const t=((e,t)=>{const n="string"==typeof t?{groupId:t}:t,r=new e.ImListGroupUserReq;_(n.nextpagetoken)&&!_(n.nextPageToken)&&(n.nextPageToken=n.nextpagetoken);const i=Object.assign(Object.assign({},te),n);return r.group_id=i.groupId,_(i.nextPageToken)&&r.setNextPageToken(i.nextPageToken.toString()),(i.sortType||0===i.sortType)&&(r.sorttype=w(i.sortType,e.ImSortType)),r.page_size=i.pageSize,r})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImListGroupUserRspCallbackWrapper.implement({OnSuccess(t){e((e=>{const t=[],n=e.user_list;for(var r=0;r<n.size();r++)t.push(P(n.get(r)));n.delete();const i=+e.getNextPageToken();return{groupId:e.group_id,nextPageToken:i,nextpagetoken:i,hasMore:e.has_more,userList:t}})(t))},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.ListGroupUser(t,r),I([t,r])})})}muteAll(e){return ae(this,0,void 0,function*(){const t="string"==typeof e?new this.wasmIns.ImMuteAllReq(e):(n=this.wasmIns,r=e,new n.ImMuteAllReq(r.groupId));var n,r;return new Promise((e,n)=>{const r=this.wasmIns.ImSdkCallbackWrapper.implement({OnSuccess(){e()},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.MuteAll(t,r),I([t,r])})})}cancelMuteAll(e){return ae(this,0,void 0,function*(){const t="string"==typeof e?new this.wasmIns.ImCancelMuteAllReq(e):(n=this.wasmIns,r=e,new n.ImCancelMuteAllReq(r.groupId));var n,r;return new Promise((e,n)=>{const r=this.wasmIns.ImSdkCallbackWrapper.implement({OnSuccess(){e()},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.CancelMuteAll(t,r),I([t,r])})})}muteUser(e){return ae(this,0,void 0,function*(){const t=((e,t)=>{const n=new e.VectorString;t.userList.forEach(e=>{n.push_back(e)});const r=new e.ImMuteUserReq(t.groupId,n);return n.delete(),r})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImSdkCallbackWrapper.implement({OnSuccess(){e()},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.MuteUser(t,r),I([t,r])})})}cancelMuteUser(e){return ae(this,0,void 0,function*(){const t=((e,t)=>{const n=new e.VectorString;t.userList.forEach(e=>{n.push_back(e)});const r=new e.ImCancelMuteUserReq(t.groupId,n);return n.delete(),r})(this.wasmIns,e);return new Promise((e,n)=>{const r=this.wasmIns.ImSdkCallbackWrapper.implement({OnSuccess(){e()},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.CancelMuteUser(t,r),I([t,r])})})}listMuteUsers(e){return ae(this,0,void 0,function*(){const t="string"==typeof e?new this.wasmIns.ImListMuteUsersReq(e):(n=this.wasmIns,r=e,new n.ImListMuteUsersReq(r.groupId));var n,r;return new Promise((e,n)=>{const r=this.wasmIns.ImListMuteUsersRspCallbackWrapper.implement({OnSuccess(t){e((e=>{const t=e.mute_user_list,n=e.white_user_list,r={groupId:e.group_id,muteAll:e.mute_all,muteUserList:v(t),whiteUserList:v(n)};return null==t||t.delete(),null==n||n.delete(),r})(t))},OnFailure(e){n(j.fromWASMError(e))}});this.wasmGroupManager.ListMuteUsers(t,r),I([t,r])})})}}var se={exports:{}};var ue,ce={exports:{}};function le(){return ue||(ue=1,ce.exports=(t=t||function(t,n){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==e&&e.crypto&&(r=e.crypto),!r)try{r=require("crypto")}catch(e){}var i=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),o={},s=o.lib={},u=s.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=n?t:4*e.length},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var a=0;a<i;a++){var o=n[a>>>2]>>>24-a%4*8&255;t[r+a>>>2]|=o<<24-(r+a)%4*8}else for(var s=0;s<i;s+=4)t[r+s>>>2]=n[s>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(i());return new c.init(t,e)}}),l=o.enc={},f=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var a=t[i>>>2]>>>24-i%4*8&255;r.push((a>>>4).toString(16)),r.push((15&a).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},h=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var a=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(a))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},d=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},p=s.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var n,r=this._data,i=r.words,a=r.sigBytes,o=this.blockSize,s=a/(4*o),u=(s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0))*o,l=t.min(4*u,a);if(u){for(var f=0;f<u;f+=o)this._doProcessBlock(i,f);n=i.splice(0,u),r.sigBytes-=l}return new c.init(n,l)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});s.Hasher=p.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}});var m=o.algo={};return o}(Math),t)),ce.exports;var t}var fe,he={exports:{}};function de(){return fe?he.exports:(fe=1,he.exports=(s=le(),t=(e=s).lib,n=t.WordArray,r=t.Hasher,i=e.algo,a=[],o=i.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],u=n[4],c=0;c<80;c++){if(c<16)a[c]=0|e[t+c];else{var l=a[c-3]^a[c-8]^a[c-14]^a[c-16];a[c]=l<<1|l>>>31}var f=(r<<5|r>>>27)+u+a[c];f+=c<20?1518500249+(i&o|~i&s):c<40?1859775393+(i^o^s):c<60?(i&o|i&s|o&s)-1894007588:(i^o^s)-899497514,u=s,s=o,o=i<<30|i>>>2,i=r,r=f}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),e.SHA1=r._createHelper(o),e.HmacSHA1=r._createHmacHelper(o),s.SHA1));var e,t,n,r,i,a,o,s}var pe,me,ge,ve,ye,we={exports:{}};var _e=t(se.exports=function(e){return e.HmacSHA1}(le(),de(),pe||(pe=1,we.exports=(me=le(),ve=(ge=me).lib.Base,ye=ge.enc.Utf8,void(ge.algo.HMAC=ve.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=ye.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),o=i.words,s=a.words,u=0;u<n;u++)o[u]^=1549556828,s[u]^=909522486;i.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))))),be={exports:{}};be.exports=function(e){return function(){var t=e,n=t.lib.WordArray;function r(e,t,r){for(var i=[],a=0,o=0;o<t;o++)if(o%4){var s=r[e.charCodeAt(o-1)]<<o%4*2|r[e.charCodeAt(o)]>>>6-o%4*2;i[a>>>2]|=s<<24-a%4*8,a++}return n.create(i,a)}t.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],a=0;a<n;a+=3)for(var o=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<n;s++)i.push(r.charAt(o>>>6*(3-s)&63));var u=r.charAt(64);if(u)for(;i.length%4;)i.push(u);return i.join("")},parse:function(e){var t=e.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var a=0;a<n.length;a++)i[n.charCodeAt(a)]=a}var o=n.charAt(64);if(o){var s=e.indexOf(o);-1!==s&&(t=s)}return r(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(le());var Re,Oe,Ie=t(be.exports);(Oe=Re||(Re={}))[Oe.NONE=0]="NONE",Oe[Oe.DBUG=1]="DBUG",Oe[Oe.INFO=2]="INFO",Oe[Oe.WARN=3]="WARN",Oe[Oe.ERROR=4]="ERROR";var Ee=Re;let Te=Ee.INFO;const Ce=(e=Ee.INFO,...t)=>{const n=new Date;e>=Te&&console.log(`[${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()} ${n.getHours()}:${n.getMinutes()}:${n.getSeconds()}.${n.getMilliseconds()}]`,...t)};var Se=e=>{Te=e},Ae=(...e)=>{Ce(Ee.DBUG,...e)},Me=(...e)=>{Ce(Ee.ERROR,...e)},Pe=function(e,t,n,r){return new(n||(n=Promise))(function(t,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(a,o)}s((r=r.apply(e,[])).next())})};class Ne{constructor(){Object.defineProperty(this,"ossPlugin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ossConfigs",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}destroy(){this.abortUpload(),this.ossPlugin&&(this.ossPlugin.delete(),this.ossPlugin=void 0)}initOssPlugin(e){const t=e.ImOssPluginWrapper.implement({Active:e=>{const t={endpoint:((n=e).endpoint||"").replace(/^https?:\/\//,""),region:"oss-"+n.region,bucket:n.bucket,uploadPartSize:Number.parseInt(n.uploadPartSize)||1048576,uploadPartNum:n.uploadPartNum};var n;Ae("active oss plugin: ",t),this.init(t).catch(e=>{Me("active oss plugin error: ",e)})},Destroy:()=>{this.abortUpload()},Upload:(t,n,r,i,a)=>{const o={expiration:1e3*(s=n).expiration,stsToken:s.securityToken,accessKeyId:s.accessKeyId,accessKeySecret:s.accessKeySecret};var s;Ae("upload: ",o,r,i);const u=e.OnOssPluginCallback.CopyPtr(a);this.upload(t,o,r,i,u)},CancelUpload:e=>(this.abortAttachmentUpload(e),!0)});return this.ossPlugin=t,t}preload(e,t){return Promise.resolve()}loadSdk(e){return Promise.resolve()}init(e){return Pe(this,0,void 0,function*(){return Promise.resolve()})}abortUpload(){}abortAttachmentUpload(e){return Pe(this,0,void 0,function*(){return Promise.resolve()})}upload(e,t,n,r,i){return Promise.resolve()}getAttachmentParams(e,t){return new Promise(n=>{n({id:t.id||"",access_key:t.filePath||"",file_name:t.fileName,file_size:0,file_duration:0,file_type:e.ImAttachmentType.values[t.fileType],extra:t.extra||""})})}}var Le=function(e,t,n,r){return new(n||(n=Promise))(function(t,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(a,o)}s((r=r.apply(e,[])).next())})};class xe extends Ne{constructor(){super(),Object.defineProperty(this,"taskCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}init(e){return Le(this,0,void 0,function*(){this.ossConfigs=e})}getUploadFormData(e,t){var n;const r={expiration:new Date(t.expiration).toISOString(),conditions:[{bucket:null===(n=this.ossConfigs)||void 0===n?void 0:n.bucket}]},i=globalThis.btoa(JSON.stringify(r)),a=(o=t.accessKeySecret,s=i,Ie.stringify(_e(s,o)));var o,s;return{key:e,OSSAccessKeyId:t.accessKeyId,signature:a,policy:i,"x-oss-security-token":t.stsToken}}abortUpload(){this.taskCache.forEach((e,t)=>{e.abort(),this.taskCache.delete(t)})}abortAttachmentUpload(e){return Le(this,0,void 0,function*(){if(this.taskCache.has(e)){const t=this.taskCache.get(e);t&&(t.abort(),this.taskCache.delete(e))}})}upload(e,t,n,r,i){return Le(this,0,void 0,function*(){if(!this.ossConfigs)return void i.OnError("-1","wx: please init oss first");const a=this.getUploadFormData(r,t),o=`https://${this.ossConfigs.bucket}.${this.ossConfigs.endpoint}`;Ae("wx upload file: ",o,a);const s=wx.uploadFile({url:o,filePath:n,name:"file",formData:a,success:e=>{Ae("upload result: ",e),204===e.statusCode?i.OnSuccess():i.OnError("-1",`status code: ${e.statusCode}`)},fail:e=>{Me("upload fail: ",e),i.OnError("-1",e.errMsg||"wx: upload file error")},complete:()=>{i.delete(),this.taskCache.delete(e)}});this.taskCache.set(e,s),s.onProgressUpdate(e=>{i.OnProgress(e.progress,e.totalBytesSent,e.totalBytesExpectedToSend)})})}getAttachmentParams(e,t){return new Promise((n,r)=>{if(!t.filePath)return void r(new j("attachment.filePath is required"));if(!t.fileName)return void r(new j("attachment.fileName is required"));const i=t.fileType||V.OTHER,a={id:t.id||"",access_key:t.filePath,file_name:t.fileName,file_size:0,file_duration:0,file_type:e.ImAttachmentType.values[i],extra:t.extra||""};wx.getFileSystemManager().getFileInfo({filePath:t.filePath,success:e=>{a.file_size=e.size||0,n(a)},fail:e=>{Me(new j("wx: get file info error"),e),n(a)}})})}}class ke{static getInstance(){return ke.ins||(ke.ins=new xe),ke.ins}}var je=function(e,t,n,r){return new(n||(n=Promise))(function(t,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(a,o)}s((r=r.apply(e,[])).next())})};class De{constructor(e,t){Object.defineProperty(this,"wasmIns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uploader",{enumerable:!0,configurable:!0,writable:!0,value:ke.getInstance()}),this.wasmIns=e,this.attachmentManager=t.GetAttachmentManager()}static getInstance(e,t){return De.instance||(De.instance=new De(e,t)),De.instance}getAttachmentReq(e){return je(this,0,void 0,function*(){const t=yield this.uploader.getAttachmentParams(this.wasmIns,e),n=this.wasmIns.ImAttachmentProgressCallbackWrapper.implement({OnProgress(t){var n,r;null===(n=null==e?void 0:e.onProgress)||void 0===n||n.call(e,{progress:(r=t).progress,totalSize:r.total_size,currentSize:r.current_size})}}),r=this.wasmIns.ImAttachmentVerifyCallbackWrapper.implement({OnProgress(e){}}),i=new this.wasmIns.ImMessageAttachmentReq;return i.progress_callback=n,i.verify_callback=r,i.attachment=t,n.delete(),r.delete(),i})}uploadAttachment(e,t){return je(this,0,void 0,function*(){const n=yield this.getAttachmentReq(t);return new Promise((t,r)=>{const i=this.wasmIns.ImAttachmentCallbackWrapper.implement({OnSuccess(e){var n;t({id:(n=e).id,fileType:n.file_type.value,fileSize:n.file_size,fileName:n.file_name,accessKey:n.access_key,fileDuration:n.file_duration,extra:n.extra})},OnFailure(e){r(j.fromWASMError(e))}});this.attachmentManager.UploadAttachment(e,n,i),I([n,i])})})}cancelAttachmentUpload(e){return je(this,0,void 0,function*(){return new Promise((t,n)=>{const r=this.wasmIns.ImSdkCallbackWrapper.implement({OnSuccess(){t()},OnFailure(e){n(j.fromWASMError(e))}});this.attachmentManager.CancelAttachmentUpload(e,r),I([r])})})}deleteAttachment(e){return je(this,0,void 0,function*(){return new Promise((t,n)=>{const r=this.wasmIns.ImSdkCallbackWrapper.implement({OnSuccess(){t()},OnFailure(e){n(j.fromWASMError(e))}}),i=Y(this.wasmIns,e);this.attachmentManager.DeleteAttachment(i,r),I([r])})})}destroy(){this.attachmentManager&&(this.attachmentManager.delete(),this.attachmentManager=null),De.instance=null}}Object.defineProperty(De,"instance",{enumerable:!0,configurable:!0,writable:!0,value:null});const Fe={appId:"",appSign:"",logLevel:Ee.INFO,extra:{}},$e={nonce:"",timestamp:0,role:"",token:""},Ue=e=>{const t=Object.assign(Object.assign({},$e),e);return{nonce:t.nonce,timestamp:t.timestamp.toString(),role:t.role,token:t.token}};var We,Ge;(Ge=We||(We={}))[Ge.ERROR_HAS_LOGIN=304]="ERROR_HAS_LOGIN",Ge[Ge.ERROR_INVALID_PARAM=400]="ERROR_INVALID_PARAM",Ge[Ge.ERROR_NO_PERMISSION=403]="ERROR_NO_PERMISSION",Ge[Ge.ERROR_NO_SESSION=404]="ERROR_NO_SESSION",Ge[Ge.ERROR_AUDIT_FAIL=406]="ERROR_AUDIT_FAIL",Ge[Ge.ERROR_INTERNAL_BUSY=412]="ERROR_INTERNAL_BUSY",Ge[Ge.ERROR_INTERNAL_BUSY2=413]="ERROR_INTERNAL_BUSY2",Ge[Ge.ERROR_USER_OFFLINE=424]="ERROR_USER_OFFLINE",Ge[Ge.ERROR_GROUP_NOT_JOINED=425]="ERROR_GROUP_NOT_JOINED",Ge[Ge.ERROR_INTERNAL_BUSY3=429]="ERROR_INTERNAL_BUSY3",Ge[Ge.ERROR_GROUP_NOT_EXIST=440]="ERROR_GROUP_NOT_EXIST",Ge[Ge.ERROR_GROUP_DELETED=441]="ERROR_GROUP_DELETED",Ge[Ge.ERROR_SEND_GROUP_MSG_FAIL=442]="ERROR_SEND_GROUP_MSG_FAIL",Ge[Ge.ERROR_REACH_MAX=443]="ERROR_REACH_MAX",Ge[Ge.ERROR_JOIN_GROUP_FAIL=450]="ERROR_JOIN_GROUP_FAIL",Ge[Ge.ERROR_OTS_FAIL=480]="ERROR_OTS_FAIL",Ge[Ge.ERROR_INTERNALE_RROR=500]="ERROR_INTERNALE_RROR",Ge[Ge.ERROR_CLIENT_REPEATED_INIT=-1]="ERROR_CLIENT_REPEATED_INIT",Ge[Ge.ERROR_CLIENT_INIT_INVALID_PARAM=-2]="ERROR_CLIENT_INIT_INVALID_PARAM",Ge[Ge.ERROR_CLIENT_NOT_INIT=1]="ERROR_CLIENT_NOT_INIT",Ge[Ge.ERROR_CLIENT_INVALID_PARAM=2]="ERROR_CLIENT_INVALID_PARAM",Ge[Ge.ERROR_CLIENT_INVALID_STATE=3]="ERROR_CLIENT_INVALID_STATE",Ge[Ge.ERROR_CLIENT_CONNECT_ERROR=4]="ERROR_CLIENT_CONNECT_ERROR",Ge[Ge.ERROR_CLIENT_CONNECT_TIMEOUT=5]="ERROR_CLIENT_CONNECT_TIMEOUT",Ge[Ge.ERROR_CLIENT_SEND_FAILED=6]="ERROR_CLIENT_SEND_FAILED",Ge[Ge.ERROR_CLIENT_SEND_CANCEL=7]="ERROR_CLIENT_SEND_CANCEL",Ge[Ge.ERROR_CLIENT_SEND_TIMEOUT=8]="ERROR_CLIENT_SEND_TIMEOUT",Ge[Ge.ERROR_CLIENT_SUB_ERROR=9]="ERROR_CLIENT_SUB_ERROR",Ge[Ge.ERROR_CLIENT_SUB_DISCONNECT=10]="ERROR_CLIENT_SUB_DISCONNECT",Ge[Ge.ERROR_CLIENT_SUB_TIMEOUT=11]="ERROR_CLIENT_SUB_TIMEOUT",Ge[Ge.ERROR_CLIENT_COMPRESS_ERROR=12]="ERROR_CLIENT_COMPRESS_ERROR",Ge[Ge.ERROR_CLIENT_DECOMPRESS_ERROR=13]="ERROR_CLIENT_DECOMPRESS_ERROR",Ge[Ge.ERROR_CLIENT_ENCRYPT_ERROR=14]="ERROR_CLIENT_ENCRYPT_ERROR",Ge[Ge.ERROR_CLIENT_DECRYPT_ERROR=15]="ERROR_CLIENT_DECRYPT_ERROR",Ge[Ge.ERROR_CLIENT_CONVERTER_ERROR=16]="ERROR_CLIENT_CONVERTER_ERROR",Ge[Ge.ERROR_CLIENT_PARSE_ERROR=17]="ERROR_CLIENT_PARSE_ERROR",Ge[Ge.ERROR_CLIENT_DATA_EMPTY=18]="ERROR_CLIENT_DATA_EMPTY",Ge[Ge.ERROR_CLIENT_DATA_ERROR=19]="ERROR_CLIENT_DATA_ERROR",Ge[Ge.ERROR_CLIENT_URL_ERROR=20]="ERROR_CLIENT_URL_ERROR",Ge[Ge.CONNECT_CANCEL=21]="CONNECT_CANCEL",Ge[Ge.RETRY_OVER_TIME=22]="RETRY_OVER_TIME",Ge[Ge.ERROR_INVALID_STATE=601]="ERROR_INVALID_STATE",Ge[Ge.ERROR_NOT_LOGIN=602]="ERROR_NOT_LOGIN",Ge[Ge.ERROR_RECEIVE_LAST_SESSION=603]="ERROR_RECEIVE_LAST_SESSION",Ge[Ge.ERROR_PARSE_DATA_ERROR=604]="ERROR_PARSE_DATA_ERROR";var Be=We;const ze=(e,t)=>{const n=((e,t)=>{for(const[n,r]of Object.entries(t)){const t=b(e,n),i=R(n,t,r);if(i)return i}return""})(t,{"user.userId":{required:!0,type:"string"},"userAuth.nonce":{required:!0,type:"string"},"userAuth.timestamp":{required:!0,type:"number"},"userAuth.token":{required:!0,type:"string"}});if(n)throw new j(n,Be.ERROR_CLIENT_INVALID_PARAM);const r=new e.ImLoginReq;return t.user&&(r.user=(e=>{const t=Object.assign(Object.assign({},M),e);return{user_id:t.userId,user_extension:t.userExtension}})(t.user)),t.userAuth&&(r.user_auth=Ue(t.userAuth)),r},He=(e,t,n)=>{const r=n.value;return{get(){return(...e)=>{if(this.wasmEngine&&this.wasmInterface)return r.apply(this,e);throw new j("engine not inited",Be.ERROR_CLIENT_NOT_INIT)}}}};var Ve;!function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.DISCONNECTED=3]="DISCONNECTED"}(Ve||(Ve={}));var qe=Ve;class Ye extends d{}var Ke,Je,Xe,Qe,Ze,et,tt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}u((r=r.apply(e,t||[])).next())})};class nt extends Ye{constructor(){super(),Object.defineProperty(this,"socketTask",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mainChannelId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),wx.onNetworkStatusChange(e=>{Ae("wx network status change:",e);const{isConnected:t}=e;t||this.emit("disconnected",-1,null==e?void 0:e.networkType)})}subscribe(e){return tt(this,arguments,void 0,function*({channelId:e,url:t,label:n,isMain:r}){Ae("wx websocket subscribe",e,t,n),this.url||(this.url=t.replace("wss:///","wss://rcoims.rtn.aliyuncs.com/")),r&&(yield this.connect(this.url))})}unSubscribe(e){return tt(this,void 0,void 0,function*(){e===this.mainChannelId&&this.closeSocket()})}closeSocket(){var e;this.url=void 0;try{null===(e=this.socketTask)||void 0===e||e.close()}catch(e){}this.socketTask=void 0}onReceiveMessage(e){Ae("wx websocket received: ",this.mainChannelId,e),this.emit("message",this.mainChannelId||1,e)}connect(e){return tt(this,void 0,void 0,function*(){if(!e||0!==e.indexOf("wss://"))throw new j("websocket url error");const t=wx.connectSocket({url:e}),n=Date.now();yield new Promise((e,r)=>{t.onError(e=>tt(this,void 0,void 0,function*(){const t=Date.now()-n;t<500&&(yield new Promise(e=>{setTimeout(()=>{e(t)},500-t)})),Me("wx websocket error",e),r(new j(e.errMsg,Be.ERROR_CLIENT_CONNECT_ERROR))})),t.onOpen(()=>{e(t)})}),t.onMessage(e=>{this.onReceiveMessage(e.data)}),t.onClose(e=>{Ae("wx websocket close",e),this.emit("disconnected",null==e?void 0:e.code,null==e?void 0:e.reason)}),this.socketTask=t})}send(e,t){return tt(this,void 0,void 0,function*(){var n;this.mainChannelId=e,Ae("wx websocket send",t),null===(n=this.socketTask)||void 0===n||n.send({data:t})})}destroy(){this.removeAllListeners(),this.closeSocket(),this.mainChannelId=void 0}}(Je=Ke||(Ke={}))[Je.Test=17e3]="Test";class rt{static init(e){this.reporter||(this.reporter=e.GetWasmStatManager())}static destroy(){this.reporter=void 0}static send(e,t){this.reporter&&this.reporter.stat(e,JSON.stringify(t))}}(Qe=Xe||(Xe={}))[Qe.BACKGROUND=0]="BACKGROUND",Qe[Qe.FOREGROUND=1]="FOREGROUND",Qe[Qe.NETWORK_DISCONNECTED=2]="NETWORK_DISCONNECTED",Qe[Qe.NETWORK_CONNECTED=3]="NETWORK_CONNECTED";class it{constructor(){Object.defineProperty(this,"wasmInterface",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}}class at extends it{constructor(){super(...arguments),Object.defineProperty(this,"onAppShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null===(e=this.wasmInterface)||void 0===e||e.NotifyAppEvent(Xe.FOREGROUND)}}),Object.defineProperty(this,"onAppHide",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null===(e=this.wasmInterface)||void 0===e||e.NotifyAppEvent(Xe.BACKGROUND)}}),Object.defineProperty(this,"onNetworkStatusChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,n;e.isConnected?null===(t=this.wasmInterface)||void 0===t||t.NotifyAppEvent(Xe.NETWORK_CONNECTED):null===(n=this.wasmInterface)||void 0===n||n.NotifyAppEvent(Xe.NETWORK_DISCONNECTED)}})}init(e){this.wasmInterface=e,wx&&(wx.onAppShow(this.onAppShow),wx.onAppHide(this.onAppHide),wx.onNetworkStatusChange(this.onNetworkStatusChange))}destory(){wx&&(wx.offAppShow(this.onAppShow),wx.offAppHide(this.onAppHide),wx.offNetworkStatusChange(this.onNetworkStatusChange))}}(et=Ze||(Ze={}))[et.DEFAULT=0]="DEFAULT",et[et.CN=1]="CN",et[et.SEA=2]="SEA";var ot=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},st=function(e,t,n,r){return new(n||(n=Promise))(function(t,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(a,o)}s((r=r.apply(e,[])).next())})};class ut extends d{constructor(){super(),Object.defineProperty(this,"wasmIns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wasmEngine",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wasmInterface",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"transport",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"appEventManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventListener",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"groupManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachmentManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pluginProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uploader",{enumerable:!0,configurable:!0,writable:!0,value:ke.getInstance()}),Object.defineProperty(this,"supportsWebRtc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportWASM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initFlag",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"initStatus",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.supportsWebRtc=!0,this.supportWASM=!0}static createEngine(){return ut.engine||(ut.engine=new ut),ut.engine}static isSupport(){return!0}static getSdkVersion(){return"1.8.0"}initTransport(){if(this.transport)return;let e;e=new nt,e.on("disconnected",(e,t)=>{var n;Ae("engine disconnected",e,t),null===(n=this.wasmIns)||void 0===n||n.wasmOnConnectionLostEvent(-15,t||"")}),e.on("message",(e,t)=>{var n;Ae("engine received",e,t),null===(n=this.wasmIns)||void 0===n||n.wasmOnReceiveData(e,t)}),this.transport=e}initAppEvent(e){this.appEventManager||(this.appEventManager=new at),this.appEventManager.init(e)}loadWasm(e){return st(this,0,void 0,function*(){let t,n=p;t=e.locateFile;const r=yield n({wasmBinary:undefined,locateFile:t,subscribe:(e,t)=>st(this,0,void 0,function*(){var n,r;let i;try{i=JSON.parse(e)}catch(e){}if(!i)throw new Error("subscribeInfo should be json string");Ae("subscribe",i,t);const{url:a,stream_id:o,data_channel_streams:s=[],is_main:u}=i,c=(null===(n=null==s?void 0:s[0])||void 0===n?void 0:n.track_label)||o,l=+o;if(!l)throw new Error("channelId should be number");let f=0;const h=Date.now();let d="";try{yield null===(r=this.transport)||void 0===r?void 0:r.subscribe({channelId:l,url:a,label:c,isMain:u})}catch(e){Me("connect error",e),d=e.msg||"unknow",f=-1}const p=Date.now()-h;0!==f&&p<500&&(yield new Promise(e=>setTimeout(e,500-p))),Ae("connectResult",f),this.wasmIns.wasmOnConnectResult(l,f,d)}),unSubscribe:(e,t)=>{var n;Ae("unSubscribe",e,t);const r=+e;null===(n=this.transport)||void 0===n||n.unSubscribe(r)},sendData:(e,t,n,r,i)=>st(this,0,void 0,function*(){var t;Ae("engine sendData",e,i),yield null===(t=this.transport)||void 0===t?void 0:t.send(e,i)})});this.wasmIns=r,yield this.wasmIns.ready})}preloadUploader(e){return st(this,0,void 0,function*(){if(e.uploader)try{yield this.uploader.preload(!!e.uploader.preload,e.uploader.sdkUrl)}catch(e){Me("preload uploader sdk failed")}})}initNativePlugin(){const e=this.uploader.initOssPlugin(this.wasmIns);this.pluginProvider=this.wasmIns.ImPluginProviderWrapper.implement({CreateOssPlugin:()=>e})}init(e){return st(this,0,void 0,function*(){void 0!==this.wasmInterface&&this.unInit();const t=Date.now();this.initFlag=t,(e.logLevel||e.logLevel===Ee.NONE)&&Se(e.logLevel),this.initTransport();try{if(yield this.preloadUploader(e),this.wasmIns||(yield this.loadWasm(e)),this.initFlag!==t)throw new j("Init has been terminated!");yield this.wasmIns.ready,this.wasmEngine||(this.wasmEngine=new this.wasmIns.ImEngine.CreateEngine),this.initNativePlugin();const n=((e,t,n)=>{const r=Object.assign(Object.assign({},Fe),t),i=new e.ImSdkConfig;if(r.deviceId&&(i.device_id=r.deviceId),i.app_id=r.appId,i.app_sign=r.appSign,(r.logLevel||0===r.logLevel)&&(i.log_level=w(r.logLevel,e.ImLogLevel)),r.source&&(i.source=r.source),r.areaCode&&(i.areaCode=r.areaCode),r.heartbeatTimeout&&r.heartbeatTimeout>=15&&r.heartbeatTimeout<=120&&(i.heartbeat_timeout=r.heartbeatTimeout),r.extra&&Object.keys(r.extra).length>0){const t=new e.StringStringMap;Object.entries(r.extra).forEach(([e,n])=>{t.set(e,n)}),i.extra=t,t.delete()}return i.plugin_provider=n,i})(this.wasmIns,e,this.pluginProvider);n.protocol=2;const r=this.wasmEngine.Init(n);if(O(n,["plugin_provider"]),this.wasmInterface||(this.wasmInterface=this.wasmEngine.GetInterface(),this.initAppEvent(this.wasmInterface)),this.initStatus=0===r||r===Be.ERROR_CLIENT_REPEATED_INIT,Ae("init result: ",r),r===Be.ERROR_CLIENT_REPEATED_INIT)return this.initFlag=0,Be.ERROR_CLIENT_REPEATED_INIT;if(0!==r)throw new j("init failed, please uninit first",r);return this.attachmentManager=De.getInstance(this.wasmIns,this.wasmInterface),this.messageManager=new Q(this.wasmIns,this.wasmInterface),this.groupManager=new oe(this.wasmIns,this.wasmInterface),rt.init(this.wasmInterface),this.addEventListener(),this.initFlag=0,0}catch(e){if(this.initFlag=0,Me(e),e instanceof j)throw e;throw new j(e.msg||e.message,e.code)}})}static isInitialized(){return ut.engine&&ut.engine.initStatus}addEventListener(){this.eventListener=this.wasmIns.ImSdkListenerWrapper.implement({OnConnecting:()=>{this.emit("connecting")},OnConnectSuccess:()=>{this.emit("connectsuccess")},OnConnectFailed:e=>{this.emit("connectfailed",e)},OnDisconnect:e=>{var t,n;null===(t=this.messageManager)||void 0===t||t.removeMessageListener(),null===(n=this.groupManager)||void 0===n||n.removeGroupListener(),this.emit("disconnect",e)},OnTokenExpired:e=>{const t=this.wasmIns.ImTokenCallback.CopyPtr(e);this.emit("tokenexpired",(e,n)=>{if(e)return t.OnError({code:e.code||0,msg:e.msg}),void I([t]);if(!n)throw I([t]),new Error("auth not found");const r=this.wasmIns.ImTokenWrapper.implement({GetAccessToken:()=>Ue(n)});t.OnSuccess(r),I([t,r])})},OnReconnectSuccess:e=>{this.emit("reconnectsuccess",(e=>{const t=[];for(var n=0;n<e.size();n++)t.push(ie(e.get(n)));return t})(e))},OnLinkStateEvent:e=>{const t=g(e.previousState,qe.IDLE),n=g(e.currentState,qe.IDLE);this.emit("linkstate",{previousState:t,currentState:n})}}),this.wasmInterface.AddSdkListener(this.eventListener)}removeEventListener(){this.eventListener&&(this.wasmInterface.RemoveSdkListener(this.eventListener),this.eventListener.delete(),this.eventListener=null)}destroy(){var e,t,n,r,i,a,o;this.removeEventListener(),null===(e=this.groupManager)||void 0===e||e.destroy(),this.groupManager=void 0,null===(t=this.messageManager)||void 0===t||t.destroy(),this.messageManager=void 0,null===(n=this.attachmentManager)||void 0===n||n.destroy(),this.attachmentManager=void 0,null===(r=this.wasmInterface)||void 0===r||r.delete(),this.wasmInterface=void 0,null===(i=this.transport)||void 0===i||i.destroy(),this.transport=void 0,null===(a=this.appEventManager)||void 0===a||a.destory(),null===(o=this.pluginProvider)||void 0===o||o.delete(),this.pluginProvider=void 0,this.uploader.destroy()}unInit(){if(this.initFlag=0,this.initStatus=!1,this.destroy(),!this.wasmEngine)return!0;const e=this.wasmEngine.UnInit();return this.wasmEngine.delete(),this.wasmEngine=null,0===e}login(e){return st(this,0,void 0,function*(){const t=ze(this.wasmIns,e),n=this;return new Promise((e,r)=>{const i=this.wasmIns.ImSdkCallback.implement({OnSuccess(){var t,r;null===(t=n.messageManager)||void 0===t||t.addMessageListener(),null===(r=n.groupManager)||void 0===r||r.addGroupListener(),e()},OnFailure(e){r(j.fromWASMError(e))}});this.wasmInterface.Login(t,i),I([t,i])})})}logout(){return st(this,0,void 0,function*(){return new Promise((e,t)=>{const n=this.wasmIns.ImSdkCallback.implement({OnSuccess(){var t;null===(t=this.transport)||void 0===t||t.destroy(),e()},OnFailure(e){t(j.fromWASMError(e))}});this.wasmInterface.Logout(n),I([n])})})}reconnect(){var e;null===(e=this.wasmIns)||void 0===e||e.wasmOnConnectionLostEvent(-15,"")}getCurrentUserId(){return this.wasmInterface.GetCurrentUserId()}isLogin(){if(!this.wasmEngine||!this.wasmInterface)return!1;return!!this.wasmInterface.IsLogin()}isLogout(){if(!this.wasmEngine||!this.wasmInterface)return!0;return!!this.wasmInterface.IsLogout()}getMessageManager(){return this.messageManager}getGroupManager(){return this.groupManager}getAttachmentManager(){return this.attachmentManager}}let ct;ot([He],ut.prototype,"login",null),ot([He],ut.prototype,"logout",null),ot([He],ut.prototype,"reconnect",null),ot([He],ut.prototype,"getCurrentUserId",null),ot([He],ut.prototype,"getMessageManager",null),ot([He],ut.prototype,"getGroupManager",null),ot([He],ut.prototype,"getAttachmentManager",null),ct=ut;var lt=ct;export{De as AliVCIMAttachmentManager,oe as AliVCIMGroupManager,Q as AliVCIMMessageManager,V as ImAttachmentType,lt as ImEngine,Be as ImErrors,Ee as ImLogLevel,A as ImMessageLevel,m as ImSortType,G as ImStreamMessageDataType,U as ImStreamMessageReceiverType,K as ImStreamMessageSender,z as ImStreamMessageStatus,F as ImStreamMessageType};
